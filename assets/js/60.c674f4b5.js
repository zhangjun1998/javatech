(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{295:function(t,a,s){"use strict";s.r(a);var e=s(2),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"zookeeper-运维指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-运维指南"}},[t._v("#")]),t._v(" ZooKeeper 运维指南")]),t._v(" "),s("blockquote",[s("p",[t._v("环境要求：JDK6+")])]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#1-%E5%8D%95%E7%82%B9%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2"}},[t._v("1. 单点服务部署")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#11-%E4%B8%8B%E8%BD%BD%E8%A7%A3%E5%8E%8B"}},[t._v("1.1. 下载解压")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#12-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"}},[t._v("1.2. 环境变量")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#13-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"}},[t._v("1.3. 修改配置")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#14-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"}},[t._v("1.4. 启动服务")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#15-%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1"}},[t._v("1.5. 停止服务")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#2-%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2"}},[t._v("2. 集群服务部署")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#21-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"}},[t._v("2.1. 修改配置")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#22-%E6%A0%87%E8%AF%86%E8%8A%82%E7%82%B9"}},[t._v("2.2. 标识节点")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#23-%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4"}},[t._v("2.3. 启动集群")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#24-%E9%9B%86%E7%BE%A4%E9%AA%8C%E8%AF%81"}},[t._v("2.4. 集群验证")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#3-%E5%91%BD%E4%BB%A4"}},[t._v("3. 命令")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#31-%E8%BF%9B%E5%85%A5%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8E%A7%E5%88%B6%E5%8F%B0"}},[t._v("3.1. 进入命令行控制台")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#32-%E8%8A%82%E7%82%B9%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"}},[t._v("3.2. 节点增删改查")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#33-%E7%9B%91%E5%90%AC%E5%99%A8"}},[t._v("3.3. 监听器")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#34-zookeeper-%E5%9B%9B%E5%AD%97%E5%91%BD%E4%BB%A4"}},[t._v("3.4. zookeeper 四字命令")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#4-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"}},[t._v("4. 参考资料")])])]),t._v(" "),s("h2",{attrs:{id:"_1-单点服务部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-单点服务部署"}},[t._v("#")]),t._v(" 1. 单点服务部署")]),t._v(" "),s("p",[t._v("在安装 ZooKeeper 之前，请确保你的系统是在以下任一操作系统上运行：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("任意 Linux OS")]),t._v(" - 支持开发和部署。适合演示应用程序。")]),t._v(" "),s("li",[s("strong",[t._v("Windows OS")]),t._v(" - 仅支持开发。")]),t._v(" "),s("li",[s("strong",[t._v("Mac OS")]),t._v(" - 仅支持开发。")])]),t._v(" "),s("p",[t._v("安装步骤如下：")]),t._v(" "),s("h3",{attrs:{id:"_1-1-下载解压"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-下载解压"}},[t._v("#")]),t._v(" 1.1. 下载解压")]),t._v(" "),s("p",[t._v("进入官方下载地址："),s("a",{attrs:{href:"http://zookeeper.apache.org/releases.html#download",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://zookeeper.apache.org/releases.html#download"),s("OutboundLink")],1),t._v(" ，选择合适版本。")]),t._v(" "),s("p",[t._v("解压到本地：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxf zookeeper-3.4.6.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" zookeeper-3.4.6\n")])])]),s("h3",{attrs:{id:"_1-2-环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-环境变量"}},[t._v("#")]),t._v(" 1.2. 环境变量")]),t._v(" "),s("p",[t._v("执行 "),s("code",[t._v("vim /etc/profile")]),t._v("，添加环境变量：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ZOOKEEPER_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/app/zookeeper-3.4.14\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ZOOKEEPER_HOME")]),t._v("/bin:"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v("\n")])])]),s("p",[t._v("再执行 "),s("code",[t._v("source /etc/profile")]),t._v(" ， 使得配置的环境变量生效。")]),t._v(" "),s("h3",{attrs:{id:"_1-3-修改配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-修改配置"}},[t._v("#")]),t._v(" 1.3. 修改配置")]),t._v(" "),s("p",[t._v("你必须创建 "),s("code",[t._v("conf/zoo.cfg")]),t._v(" 文件，否则启动时会提示你没有此文件。")]),t._v(" "),s("p",[t._v("初次尝试，不妨直接使用 Kafka 提供的模板配置文件 "),s("code",[t._v("conf/zoo_sample.cfg")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" conf/zoo_sample.cfg conf/zoo.cfg\n")])])]),s("p",[t._v("修改后完整配置如下：")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of milliseconds of each tick")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of ticks that the initial")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# synchronization phase can take")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of ticks that can pass between")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sending a request and getting an acknowledgement")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the directory where the snapshot is stored.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# do not use /tmp for storage, /tmp here is just")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# example sakes.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/zookeeper/data")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataLogDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/zookeeper/log")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the port at which the clients will connect")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2181")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the maximum number of client connections.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# increase this if you need to handle more clients")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#maxClientCnxns=60")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Be sure to read the maintenance section of the")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# administrator guide before turning on autopurge.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The number of snapshots to retain in dataDir")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#autopurge.snapRetainCount=3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Purge task interval in hours")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Set to "0" to disable auto purge feature')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#autopurge.purgeInterval=1")]),t._v("\n")])])]),s("p",[t._v("配置参数说明：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("tickTime")]),t._v("：用于计算的基础时间单元。比如 session 超时：N*tickTime；")]),t._v(" "),s("li",[s("strong",[t._v("initLimit")]),t._v("：用于集群，允许从节点连接并同步到 master 节点的初始化连接时间，以 tickTime 的倍数来表示；")]),t._v(" "),s("li",[s("strong",[t._v("syncLimit")]),t._v("：用于集群， master 主节点与从节点之间发送消息，请求和应答时间长度（心跳机制）；")]),t._v(" "),s("li",[s("strong",[t._v("dataDir")]),t._v("：数据存储位置；")]),t._v(" "),s("li",[s("strong",[t._v("dataLogDir")]),t._v("：日志目录；")]),t._v(" "),s("li",[s("strong",[t._v("clientPort")]),t._v("：用于客户端连接的端口，默认 2181")])]),t._v(" "),s("h3",{attrs:{id:"_1-4-启动服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-启动服务"}},[t._v("#")]),t._v(" 1.4. 启动服务")]),t._v(" "),s("p",[t._v("执行以下命令")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bin/zkServer.sh start\n")])])]),s("p",[t._v("执行此命令后，你将收到以下响应")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("JMX enabled by default\nUsing config: /Users/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/zookeeper-3.4.6/bin/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/conf/zoo.cfg\nStarting zookeeper "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". STARTED\n")])])]),s("h3",{attrs:{id:"_1-5-停止服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-停止服务"}},[t._v("#")]),t._v(" 1.5. 停止服务")]),t._v(" "),s("p",[t._v("可以使用以下命令停止 zookeeper 服务器。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bin/zkServer.sh stop\n")])])]),s("h2",{attrs:{id:"_2-集群服务部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-集群服务部署"}},[t._v("#")]),t._v(" 2. 集群服务部署")]),t._v(" "),s("p",[t._v("分布式系统节点数一般都要求是奇数，且最少为 3 个节点，Zookeeper 也不例外。")]),t._v(" "),s("p",[t._v("这里，规划一个含 3 个节点的最小 ZooKeeper 集群，主机名分别为 hadoop001，hadoop002，hadoop003 。")]),t._v(" "),s("h3",{attrs:{id:"_2-1-修改配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-修改配置"}},[t._v("#")]),t._v(" 2.1. 修改配置")]),t._v(" "),s("p",[t._v("修改配置文件 "),s("code",[t._v("zoo.cfg")]),t._v("，内容如下：")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/zookeeper-cluster/data/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("dataLogDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/usr/local/zookeeper-cluster/log/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2181")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# server.1 这个1是服务器的标识，可以是任意有效数字，标识这是第几个服务器节点，这个标识要写到dataDir目录下面myid文件里")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指名集群间通讯端口和选举端口")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("hadoop001:2287:3387")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("hadoop002:2287:3387")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server.3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("hadoop003:2287:3387")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-2-标识节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-标识节点"}},[t._v("#")]),t._v(" 2.2. 标识节点")]),t._v(" "),s("p",[t._v("分别在三台主机的 "),s("code",[t._v("dataDir")]),t._v(" 目录下新建 "),s("code",[t._v("myid")]),t._v(" 文件,并写入对应的节点标识。Zookeeper 集群通过 "),s("code",[t._v("myid")]),t._v(" 文件识别集群节点，并通过上文配置的节点通信端口和选举端口来进行节点通信，选举出 Leader 节点。")]),t._v(" "),s("p",[t._v("创建存储目录：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 三台主机均执行该命令")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -vp  /usr/local/zookeeper-cluster/data/\n")])])]),s("p",[t._v("创建并写入节点标识到 "),s("code",[t._v("myid")]),t._v(" 文件：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hadoop001主机")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /usr/local/zookeeper-cluster/data/myid\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hadoop002主机")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /usr/local/zookeeper-cluster/data/myid\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# hadoop003主机")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /usr/local/zookeeper-cluster/data/myid\n")])])]),s("h3",{attrs:{id:"_2-3-启动集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-启动集群"}},[t._v("#")]),t._v(" 2.3. 启动集群")]),t._v(" "),s("p",[t._v("分别在三台主机上，执行如下命令启动服务：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("/usr/app/zookeeper-cluster/zookeeper/bin/zkServer.sh start\n")])])]),s("h3",{attrs:{id:"_2-4-集群验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-集群验证"}},[t._v("#")]),t._v(" 2.4. 集群验证")]),t._v(" "),s("p",[t._v("启动后使用 "),s("code",[t._v("zkServer.sh status")]),t._v(" 查看集群各个节点状态。")]),t._v(" "),s("h2",{attrs:{id:"_3-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-命令"}},[t._v("#")]),t._v(" 3. 命令")]),t._v(" "),s("h3",{attrs:{id:"_3-1-进入命令行控制台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-进入命令行控制台"}},[t._v("#")]),t._v(" 3.1. 进入命令行控制台")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bin/zkCli.sh\n")])])]),s("p",[t._v("键入上述命令后，将连接到 ZooKeeper 服务器，你应该得到以下响应。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("Connecting to localhost:2181\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\nWelcome to ZooKeeper"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\nWATCHER::\nWatchedEvent state:SyncConnected type: None path:null\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-2-节点增删改查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-节点增删改查"}},[t._v("#")]),t._v(" 3.2. 节点增删改查")]),t._v(" "),s("h4",{attrs:{id:"_3-2-1-启动服务和连接服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-启动服务和连接服务"}},[t._v("#")]),t._v(" 3.2.1. 启动服务和连接服务")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动服务")]),t._v("\nbin/zkServer.sh start\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#连接服务 不指定服务地址则默认连接到localhost:2181")]),t._v("\nzkCli.sh -server hadoop001:2181\n")])])]),s("h4",{attrs:{id:"_3-2-2-help-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-help-命令"}},[t._v("#")]),t._v(" 3.2.2. help 命令")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("help")]),t._v(" 可以查看所有命令及格式。")]),t._v(" "),s("h4",{attrs:{id:"_3-2-3-查看节点列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-查看节点列表"}},[t._v("#")]),t._v(" 3.2.3. 查看节点列表")]),t._v(" "),s("p",[t._v("查看节点列表有 "),s("code",[t._v("ls path")]),t._v(" 和 "),s("code",[t._v("ls2 path")]),t._v(" 两个命令，后者是前者的增强，不仅可以查看指定路径下的所有节点，还可以查看当前节点的信息。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" /\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cluster, controller_epoch, brokers, storm, zookeeper, admin,  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ls2 /\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cluster, controller_epoch, brokers, storm, zookeeper, admin, "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ncZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x0\nctime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Thu Jan 01 08:00:00 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1970")]),t._v("\nmZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x0\nmtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Thu Jan 01 08:00:00 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1970")]),t._v("\npZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x130\ncversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v("\ndataVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\naclVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nephemeralOwner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x0\ndataLength "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nnumChildren "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-2-4-新增节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-新增节点"}},[t._v("#")]),t._v(" 3.2.4. 新增节点")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" path data acl   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 其中 -s 为有序节点，-e 临时节点")]),t._v("\n")])])]),s("p",[t._v("flag 参数指定创建的 znode 是持久的、临时的（-e），还是顺序的（-s）。")]),t._v(" "),s("ul",[s("li",[t._v("默认情况下，所有 znode 都是持久的。")]),t._v(" "),s("li",[t._v("顺序节点保证 znode 路径将是唯一的。")]),t._v(" "),s("li",[t._v("临时节点会在会话过期或客户端断开连接时被自动删除。")])]),t._v(" "),s("p",[t._v("例：创建持久节点")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("create /hadoop "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n")])])]),s("p",[t._v("例：创建有序节点，此时创建的节点名为指定节点名 + 自增序号：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" create -s /a  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aaa"')]),t._v("\nCreated /a0000000022\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" create -s /b  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bbb"')]),t._v("\nCreated /b0000000023\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" create -s /c  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ccc"')]),t._v("\nCreated /c0000000024\n")])])]),s("p",[t._v("例：创建临时节点：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" create -e /tmp  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tmp"')]),t._v("\nCreated /tmp\n")])])]),s("h4",{attrs:{id:"_3-2-5-查看节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-5-查看节点"}},[t._v("#")]),t._v(" 3.2.5. 查看节点")]),t._v(" "),s("h5",{attrs:{id:"获取节点数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取节点数据"}},[t._v("#")]),t._v(" 获取节点数据")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 格式")]),t._v("\nget path "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("watch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" get /hadoop\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#节点数据")]),t._v("\ncZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x14b\nctime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Fri May "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":03:06 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("\nmZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x14b\nmtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Fri May "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":03:06 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("\npZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x14b\ncversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ndataVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\naclVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nephemeralOwner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x0\ndataLength "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\nnumChildren "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[t._v("节点各个属性如下表。其中一个重要的概念是 Zxid(ZooKeeper Transaction Id)，ZooKeeper 节点的每一次更改都具有唯一的 Zxid，如果 Zxid1 小于 Zxid2，则 Zxid1 的更改发生在 Zxid2 更改之前。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("状态属性")])]),t._v(" "),s("th",[s("strong",[t._v("说明")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("cZxid")]),t._v(" "),s("td",[t._v("数据节点创建时的事务 ID")])]),t._v(" "),s("tr",[s("td",[t._v("ctime")]),t._v(" "),s("td",[t._v("数据节点创建时的时间")])]),t._v(" "),s("tr",[s("td",[t._v("mZxid")]),t._v(" "),s("td",[t._v("数据节点最后一次更新时的事务 ID")])]),t._v(" "),s("tr",[s("td",[t._v("mtime")]),t._v(" "),s("td",[t._v("数据节点最后一次更新时的时间")])]),t._v(" "),s("tr",[s("td",[t._v("pZxid")]),t._v(" "),s("td",[t._v("数据节点的子节点最后一次被修改时的事务 ID")])]),t._v(" "),s("tr",[s("td",[t._v("cversion")]),t._v(" "),s("td",[t._v("子节点的更改次数")])]),t._v(" "),s("tr",[s("td",[t._v("dataVersion")]),t._v(" "),s("td",[t._v("节点数据的更改次数")])]),t._v(" "),s("tr",[s("td",[t._v("aclVersion")]),t._v(" "),s("td",[t._v("节点的 ACL 的更改次数")])]),t._v(" "),s("tr",[s("td",[t._v("ephemeralOwner")]),t._v(" "),s("td",[t._v("如果节点是临时节点，则表示创建该节点的会话的 SessionID；如果节点是持久节点，则该属性值为 0")])]),t._v(" "),s("tr",[s("td",[t._v("dataLength")]),t._v(" "),s("td",[t._v("数据内容的长度")])]),t._v(" "),s("tr",[s("td",[t._v("numChildren")]),t._v(" "),s("td",[t._v("数据节点当前的子节点个数")])])])]),t._v(" "),s("h5",{attrs:{id:"查看节点状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看节点状态"}},[t._v("#")]),t._v(" 查看节点状态")]),t._v(" "),s("p",[t._v("可以使用 "),s("code",[t._v("stat")]),t._v(" 命令查看节点状态，它的返回值和 "),s("code",[t._v("get")]),t._v(" 命令类似，但不会返回节点数据。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stat")]),t._v(" /hadoop\ncZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x14b\nctime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Fri May "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":03:06 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("\nmZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x14b\nmtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Fri May "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":03:06 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("\npZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x14b\ncversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ndataVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\naclVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nephemeralOwner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x0\ndataLength "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("\nnumChildren "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-2-6-更新节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-6-更新节点"}},[t._v("#")]),t._v(" 3.2.6. 更新节点")]),t._v(" "),s("p",[t._v("更新节点的命令是 "),s("code",[t._v("set")]),t._v("，可以直接进行修改，如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" /hadoop "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("345")]),t._v("\ncZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x14b\nctime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Fri May "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":03:06 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("\nmZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x14c\nmtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Fri May "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":13:05 CST "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v("\npZxid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x14b\ncversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ndataVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注意更改后此时版本号为 1，默认创建时为 0")]),t._v("\naclVersion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nephemeralOwner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" 0x0\ndataLength "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\nnumChildren "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[t._v("也可以基于版本号进行更改，此时类似于乐观锁机制，当你传入的数据版本号 (dataVersion) 和当前节点的数据版本号不符合时，zookeeper 会拒绝本次修改：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("34")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" /hadoop "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("678")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nversion No is not valid "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" /hadoop    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#无效的版本号")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-2-7-删除节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-7-删除节点"}},[t._v("#")]),t._v(" 3.2.7. 删除节点")]),t._v(" "),s("p",[t._v("删除节点的语法如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("delete path "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("和更新节点数据一样，也可以传入版本号，当你传入的数据版本号 (dataVersion) 和当前节点的数据版本号不符合时，zookeeper 不会执行删除操作。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("36")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" delete /hadoop "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nversion No is not valid "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" /hadoop   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#无效的版本号")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("37")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" delete /hadoop "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("38")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("要想删除某个节点及其所有后代节点，可以使用递归删除，命令为 "),s("code",[t._v("rmr path")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_3-3-监听器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-监听器"}},[t._v("#")]),t._v(" 3.3. 监听器")]),t._v(" "),s("h4",{attrs:{id:"_3-3-1-get-path"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-get-path"}},[t._v("#")]),t._v(" 3.3.1. get path")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("get path [watch]")]),t._v(" 注册的监听器能够在节点内容发生改变的时候，向客户端发出通知。需要注意的是 zookeeper 的触发器是一次性的 (One-time trigger)，即触发一次后就会立即失效。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" get /hadoop  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("watch")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" /hadoop "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("45678")]),t._v("\nWATCHER::\nWatchedEvent state:SyncConnected type:NodeDataChanged path:/hadoop  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#节点值改变")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-3-2-stat-path"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-stat-path"}},[t._v("#")]),t._v(" 3.3.2. stat path")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("stat path [watch]")]),t._v(" 注册的监听器能够在节点状态发生改变的时候，向客户端发出通知。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stat")]),t._v(" /hadoop "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("watch")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" /hadoop "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("112233")]),t._v("\nWATCHER::\nWatchedEvent state:SyncConnected type:NodeDataChanged path:/hadoop  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#节点值改变")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-3-3-ls-ls2-path"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-ls-ls2-path"}},[t._v("#")]),t._v(" 3.3.3. ls\\ls2 path")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("ls path [watch]")]),t._v(" 或 "),s("code",[t._v("ls2 path [watch]")]),t._v(" 注册的监听器能够监听该节点下所有"),s("strong",[t._v("子节点")]),t._v("的增加和删除操作。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" /hadoop "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("watch")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("zk: localhost:2181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CONNECTED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" create  /hadoop/yarn "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aaa"')]),t._v("\nWATCHER::\nWatchedEvent state:SyncConnected type:NodeChildrenChanged path:/hadoop\n")])])]),s("h3",{attrs:{id:"_3-4-zookeeper-四字命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-zookeeper-四字命令"}},[t._v("#")]),t._v(" 3.4. zookeeper 四字命令")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("命令")]),t._v(" "),s("th",[t._v("功能描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("conf")]),t._v(" "),s("td",[t._v("打印服务配置的详细信息。")])]),t._v(" "),s("tr",[s("td",[t._v("cons")]),t._v(" "),s("td",[t._v("列出连接到此服务器的所有客户端的完整连接/会话详细信息。包括接收/发送的数据包数量，会话 ID，操作延迟，上次执行的操作等信息。")])]),t._v(" "),s("tr",[s("td",[t._v("dump")]),t._v(" "),s("td",[t._v("列出未完成的会话和临时节点。这只适用于 Leader 节点。")])]),t._v(" "),s("tr",[s("td",[t._v("envi")]),t._v(" "),s("td",[t._v("打印服务环境的详细信息。")])]),t._v(" "),s("tr",[s("td",[t._v("ruok")]),t._v(" "),s("td",[t._v("测试服务是否处于正确状态。如果正确则返回“imok”，否则不做任何相应。")])]),t._v(" "),s("tr",[s("td",[t._v("stat")]),t._v(" "),s("td",[t._v("列出服务器和连接客户端的简要详细信息。")])]),t._v(" "),s("tr",[s("td",[t._v("wchs")]),t._v(" "),s("td",[t._v("列出所有 watch 的简单信息。")])]),t._v(" "),s("tr",[s("td",[t._v("wchc")]),t._v(" "),s("td",[t._v("按会话列出服务器 watch 的详细信息。")])]),t._v(" "),s("tr",[s("td",[t._v("wchp")]),t._v(" "),s("td",[t._v("按路径列出服务器 watch 的详细信息。")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("更多四字命令可以参阅官方文档："),s("a",{attrs:{href:"https://zookeeper.apache.org/doc/current/zookeeperAdmin.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://zookeeper.apache.org/doc/current/zookeeperAdmin.html"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("使用前需要使用 "),s("code",[t._v("yum install nc")]),t._v(" 安装 nc 命令，使用示例如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@hadoop001 bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo stat | nc localhost 2181")]),t._v("\nZookeeper version: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.4")]),t._v(".13-2d71af4dbe22557fda74f9a9b4309b15a7487f03,\nbuilt on 06/29/2018 04:05 GMT\nClients:\n /0:0:0:0:0:0:0:1:50584"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queued"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(",recved"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("371")]),t._v(",sent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("371")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n /0:0:0:0:0:0:0:1:50656"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queued"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(",recved"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(",sent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nLatency min/avg/max: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/0/19\nReceived: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("372")]),t._v("\nSent: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("371")]),t._v("\nConnections: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\nOutstanding: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nZxid: 0x150\nMode: standalone\nNode count: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("167")]),t._v("\n")])])]),s("h2",{attrs:{id:"_4-参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-参考资料"}},[t._v("#")]),t._v(" 4. 参考资料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.w3cschool.cn/zookeeper/zookeeper_installation.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Zookeeper 安装"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/heibaiying/BigData-Notes/blob/master/notes/installation/Zookeeper%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E5%92%8C%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Zookeeper 单机环境和集群环境搭建"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);