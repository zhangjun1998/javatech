<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RocketMQ | JAVATECH</title>
    <meta name="description" content="Java æ•™ç¨‹">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/javatech/favicon.ico">
    
    <link rel="preload" href="/javatech/assets/css/0.styles.0a04ceb6.css" as="style"><link rel="preload" href="/javatech/assets/js/app.fda27f19.js" as="script"><link rel="preload" href="/javatech/assets/js/4.712970d0.js" as="script"><link rel="preload" href="/javatech/assets/js/39.f7622bcc.js" as="script"><link rel="prefetch" href="/javatech/assets/js/10.27a69910.js"><link rel="prefetch" href="/javatech/assets/js/11.9a90a5e0.js"><link rel="prefetch" href="/javatech/assets/js/12.82ee8f23.js"><link rel="prefetch" href="/javatech/assets/js/13.01fa60c7.js"><link rel="prefetch" href="/javatech/assets/js/14.289ce03a.js"><link rel="prefetch" href="/javatech/assets/js/15.20146332.js"><link rel="prefetch" href="/javatech/assets/js/16.31002576.js"><link rel="prefetch" href="/javatech/assets/js/17.91db155d.js"><link rel="prefetch" href="/javatech/assets/js/18.beb24a84.js"><link rel="prefetch" href="/javatech/assets/js/19.9b63c8bd.js"><link rel="prefetch" href="/javatech/assets/js/20.7b3dd7ca.js"><link rel="prefetch" href="/javatech/assets/js/21.32da2e20.js"><link rel="prefetch" href="/javatech/assets/js/22.e98e166c.js"><link rel="prefetch" href="/javatech/assets/js/23.2de495ed.js"><link rel="prefetch" href="/javatech/assets/js/24.934d13fa.js"><link rel="prefetch" href="/javatech/assets/js/25.d8a9ef4b.js"><link rel="prefetch" href="/javatech/assets/js/26.3e60b6e9.js"><link rel="prefetch" href="/javatech/assets/js/27.03a4cf85.js"><link rel="prefetch" href="/javatech/assets/js/28.85c4983b.js"><link rel="prefetch" href="/javatech/assets/js/29.cfb40647.js"><link rel="prefetch" href="/javatech/assets/js/30.b4406b0c.js"><link rel="prefetch" href="/javatech/assets/js/31.721e5fce.js"><link rel="prefetch" href="/javatech/assets/js/32.61d9d888.js"><link rel="prefetch" href="/javatech/assets/js/33.2e2c17a0.js"><link rel="prefetch" href="/javatech/assets/js/34.a0f94a57.js"><link rel="prefetch" href="/javatech/assets/js/35.609e175d.js"><link rel="prefetch" href="/javatech/assets/js/36.650baca2.js"><link rel="prefetch" href="/javatech/assets/js/37.59188234.js"><link rel="prefetch" href="/javatech/assets/js/38.c3e47159.js"><link rel="prefetch" href="/javatech/assets/js/40.bf0b8425.js"><link rel="prefetch" href="/javatech/assets/js/41.f86852ed.js"><link rel="prefetch" href="/javatech/assets/js/42.058e48bd.js"><link rel="prefetch" href="/javatech/assets/js/43.ecce35ee.js"><link rel="prefetch" href="/javatech/assets/js/44.52f28acf.js"><link rel="prefetch" href="/javatech/assets/js/45.20f4f377.js"><link rel="prefetch" href="/javatech/assets/js/46.0a0260b9.js"><link rel="prefetch" href="/javatech/assets/js/47.eb304074.js"><link rel="prefetch" href="/javatech/assets/js/48.4b44c17f.js"><link rel="prefetch" href="/javatech/assets/js/49.7eb565e9.js"><link rel="prefetch" href="/javatech/assets/js/5.a5e63d96.js"><link rel="prefetch" href="/javatech/assets/js/50.8109a7ae.js"><link rel="prefetch" href="/javatech/assets/js/51.38b085ba.js"><link rel="prefetch" href="/javatech/assets/js/52.00ce2cbc.js"><link rel="prefetch" href="/javatech/assets/js/53.d6d7f478.js"><link rel="prefetch" href="/javatech/assets/js/54.dfdb8d1e.js"><link rel="prefetch" href="/javatech/assets/js/55.1826944b.js"><link rel="prefetch" href="/javatech/assets/js/56.66dbda5d.js"><link rel="prefetch" href="/javatech/assets/js/57.40473993.js"><link rel="prefetch" href="/javatech/assets/js/58.22b1ebc5.js"><link rel="prefetch" href="/javatech/assets/js/59.58783d5e.js"><link rel="prefetch" href="/javatech/assets/js/6.d667bc4d.js"><link rel="prefetch" href="/javatech/assets/js/60.c674f4b5.js"><link rel="prefetch" href="/javatech/assets/js/61.b6341bd9.js"><link rel="prefetch" href="/javatech/assets/js/62.89e2b730.js"><link rel="prefetch" href="/javatech/assets/js/63.0e1450bd.js"><link rel="prefetch" href="/javatech/assets/js/64.c2b3eaf7.js"><link rel="prefetch" href="/javatech/assets/js/65.4faaada8.js"><link rel="prefetch" href="/javatech/assets/js/66.4c312605.js"><link rel="prefetch" href="/javatech/assets/js/67.bf8d7dc4.js"><link rel="prefetch" href="/javatech/assets/js/68.9e1d5c1a.js"><link rel="prefetch" href="/javatech/assets/js/69.717b63a7.js"><link rel="prefetch" href="/javatech/assets/js/7.49d24c76.js"><link rel="prefetch" href="/javatech/assets/js/8.319b7672.js"><link rel="prefetch" href="/javatech/assets/js/9.1c70efd1.js"><link rel="prefetch" href="/javatech/assets/js/vendors~flowchart.f5cdfab1.js"><link rel="prefetch" href="/javatech/assets/js/vendors~notification.7414fc30.js">
    <link rel="stylesheet" href="/javatech/assets/css/0.styles.0a04ceb6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javatech/" class="home-link router-link-active"><img src="images/dunwu-logo-100.png" alt="JAVATECH" class="logo"> <span class="site-name can-hide">JAVATECH</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javatech/framework/" class="nav-link">
  æ¡†æ¶
</a></div><div class="nav-item"><a href="/javatech/cache/" class="nav-link">
  ç¼“å­˜
</a></div><div class="nav-item"><a href="/javatech/mq/" class="nav-link router-link-active">
  æ¶ˆæ¯é˜Ÿåˆ—
</a></div><div class="nav-item"><a href="/javatech/search/" class="nav-link">
  æœç´¢å¼•æ“
</a></div><div class="nav-item"><a href="/javatech/storage/" class="nav-link">
  å­˜å‚¨
</a></div><div class="nav-item"><a href="/javatech/soa/" class="nav-link">
  å¾®æœåŠ¡
</a></div><div class="nav-item"><a href="/javatech/security/" class="nav-link">
  å®‰å…¨
</a></div><div class="nav-item"><a href="/javatech/test/" class="nav-link">
  æµ‹è¯•
</a></div><div class="nav-item"><a href="/javatech/server/" class="nav-link">
  æœåŠ¡å™¨
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/javatech" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/javatech/framework/" class="nav-link">
  æ¡†æ¶
</a></div><div class="nav-item"><a href="/javatech/cache/" class="nav-link">
  ç¼“å­˜
</a></div><div class="nav-item"><a href="/javatech/mq/" class="nav-link router-link-active">
  æ¶ˆæ¯é˜Ÿåˆ—
</a></div><div class="nav-item"><a href="/javatech/search/" class="nav-link">
  æœç´¢å¼•æ“
</a></div><div class="nav-item"><a href="/javatech/storage/" class="nav-link">
  å­˜å‚¨
</a></div><div class="nav-item"><a href="/javatech/soa/" class="nav-link">
  å¾®æœåŠ¡
</a></div><div class="nav-item"><a href="/javatech/security/" class="nav-link">
  å®‰å…¨
</a></div><div class="nav-item"><a href="/javatech/test/" class="nav-link">
  æµ‹è¯•
</a></div><div class="nav-item"><a href="/javatech/server/" class="nav-link">
  æœåŠ¡å™¨
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Javaç³»åˆ—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot æ•™ç¨‹ ğŸ“š
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/javatech" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>RocketMQ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javatech/mq/rocketmq.html#ç®€ä»‹" class="sidebar-link">ç®€ä»‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/javatech/mq/rocketmq.html#å®‰è£…" class="sidebar-link">å®‰è£…</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#ç¯å¢ƒè¦æ±‚" class="sidebar-link">ç¯å¢ƒè¦æ±‚</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#ä¸‹è½½è§£å‹" class="sidebar-link">ä¸‹è½½è§£å‹</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#å¯åŠ¨-name-server" class="sidebar-link">å¯åŠ¨ Name Server</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#å¯åŠ¨-broker" class="sidebar-link">å¯åŠ¨ Broker</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#æ”¶å‘æ¶ˆæ¯" class="sidebar-link">æ”¶å‘æ¶ˆæ¯</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#å…³é—­æœåŠ¡å™¨" class="sidebar-link">å…³é—­æœåŠ¡å™¨</a></li></ul></li><li><a href="/javatech/mq/rocketmq.html#api" class="sidebar-link">API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#producer" class="sidebar-link">Producer</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#consumer" class="sidebar-link">Consumer</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#faq" class="sidebar-link">FAQ</a></li></ul></li><li><a href="/javatech/mq/rocketmq.html#æ¶æ„" class="sidebar-link">æ¶æ„</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#nameserver" class="sidebar-link">NameServer</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#broker" class="sidebar-link">Broker</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#producer-2" class="sidebar-link">Producer</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#consumer-2" class="sidebar-link">Consumer</a></li></ul></li><li><a href="/javatech/mq/rocketmq.html#åŸç†" class="sidebar-link">åŸç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#é¡ºåºæ¶ˆæ¯" class="sidebar-link">é¡ºåºæ¶ˆæ¯</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#æ¶ˆæ¯é‡å¤" class="sidebar-link">æ¶ˆæ¯é‡å¤</a></li><li class="sidebar-sub-header"><a href="/javatech/mq/rocketmq.html#äº‹åŠ¡æ¶ˆæ¯" class="sidebar-link">äº‹åŠ¡æ¶ˆæ¯</a></li></ul></li><li><a href="/javatech/mq/rocketmq.html#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rocketmq"><a href="#rocketmq" class="header-anchor">#</a> RocketMQ</h1> <h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="header-anchor">#</a> ç®€ä»‹</h2> <p>RocketMQ æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒåŸºäºé«˜å¯ç”¨åˆ†å¸ƒå¼é›†ç¾¤æŠ€æœ¯ï¼Œæä¾›ä½å»¶æ—¶çš„ã€é«˜å¯é çš„æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜…æœåŠ¡ã€‚</p> <p>RocketMQ è¢«é˜¿é‡Œå·´å·´æèµ ç»™ Apacheï¼Œæˆä¸º Apache çš„å­µåŒ–é¡¹ç›®ã€‚</p> <div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/distributed/mq/rocketmq/rmq-model.png!zp"></div> <p>RocketMQ æœ‰ä»¥ä¸‹æ ¸å¿ƒæ¦‚å¿µï¼š</p> <ul><li><strong>Producer</strong> - å°†ä¸šåŠ¡åº”ç”¨ç¨‹åºç³»ç»Ÿç”Ÿæˆçš„æ¶ˆæ¯å‘é€ç»™ä»£ç†ã€‚RocketMQ æä¾›å¤šç§å‘é€èŒƒä¾‹ï¼šåŒæ­¥ï¼Œå¼‚æ­¥å’Œå•å‘ã€‚
<ul><li><strong>Producer Group</strong> - å…·æœ‰ç›¸åŒè§’è‰²çš„ Producer ç»„åˆåœ¨ä¸€èµ·ã€‚å¦‚æœåŸå§‹ Producer åœ¨äº‹åŠ¡ä¹‹åå´©æºƒï¼Œåˆ™ä»£ç†å¯ä»¥è”ç³»åŒä¸€ Producer ç»„çš„ä¸åŒ Producer å®ä¾‹ä»¥æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚<em><strong>è­¦å‘Šï¼šè€ƒè™‘åˆ°æä¾›çš„ Producer åœ¨å‘é€æ¶ˆæ¯æ–¹é¢è¶³å¤Ÿå¼ºå¤§ï¼Œæ¯ä¸ª Producer ç»„åªå…è®¸ä¸€ä¸ªå®ä¾‹ï¼Œä»¥é¿å…ä¸å¿…è¦çš„ç”Ÿæˆå™¨å®ä¾‹åˆå§‹åŒ–ã€‚</strong></em></li></ul></li> <li><strong>Consumer</strong> - Consumer ä» Broker é‚£é‡Œè·å–æ¶ˆæ¯å¹¶å°†å…¶æä¾›ç»™åº”ç”¨ç¨‹åºã€‚ä»ç”¨æˆ·åº”ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œæä¾›äº†ä¸¤ç§ç±»å‹çš„ Consumerï¼š
<ul><li><strong>PullConsumer</strong> - PullConsumer ç§¯æåœ°ä» Broker é‚£é‡Œè·å–æ¶ˆæ¯ã€‚ä¸€æ—¦æå–äº†æ‰¹é‡æ¶ˆæ¯ï¼Œç”¨æˆ·åº”ç”¨ç¨‹åºå°±ä¼šå¯åŠ¨æ¶ˆè´¹è¿‡ç¨‹ã€‚</li> <li><strong>PushConsumer</strong> - PushConsumer å°è£…æ¶ˆæ¯æå–ï¼Œæ¶ˆè´¹è¿›åº¦å¹¶ç»´æŠ¤å…¶ä»–å†…éƒ¨å·¥ä½œï¼Œä¸ºæœ€ç»ˆç”¨æˆ·ç•™ä¸‹å›è°ƒæ¥å£ï¼Œè¿™ä¸ªå€Ÿå£ä¼šåœ¨æ¶ˆæ¯åˆ°è¾¾æ—¶è¢«æ‰§è¡Œã€‚</li> <li><strong>Consumer Group</strong> - å®Œå…¨ç›¸åŒè§’è‰²çš„ Consumer è¢«ç»„åˆåœ¨ä¸€èµ·å¹¶å‘½åä¸º Consumer Groupã€‚Consumer Group æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¦‚å¿µï¼Œåœ¨æ¶ˆæ¯æ¶ˆè´¹æ–¹é¢å®ç°è´Ÿè½½å¹³è¡¡å’Œå®¹é”™ç›®æ ‡éå¸¸å®¹æ˜“ã€‚<em><strong>è­¦å‘Šï¼šConsumer Group ä¸­çš„ Consumer å®ä¾‹å¿…é¡»å…·æœ‰å®Œå…¨ç›¸åŒçš„ä¸»é¢˜è®¢é˜…ã€‚</strong></em></li></ul></li> <li><strong>Broker</strong> - Broker æ˜¯ RocketMQ çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚å®ƒæ¥æ”¶ä» Producer å‘é€çš„æ¶ˆæ¯ï¼Œå­˜å‚¨å®ƒä»¬å¹¶å‡†å¤‡å¤„ç†æ¥è‡ª Consumer çš„æ¶ˆè´¹è¯·æ±‚ã€‚å®ƒè¿˜å­˜å‚¨ä¸æ¶ˆæ¯ç›¸å…³çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ Consumer Groupï¼Œæ¶ˆè€—è¿›åº¦åç§»å’Œä¸»é¢˜/é˜Ÿåˆ—ä¿¡æ¯ã€‚</li> <li>Name Server - å……å½“è·¯ç”±ä¿¡æ¯æä¾›è€…ã€‚Producer/Consumer å®¢æˆ·æŸ¥æ‰¾ä¸»é¢˜ä»¥æŸ¥æ‰¾ç›¸åº”çš„ Broker åˆ—è¡¨ã€‚</li> <li><strong>Topic</strong> - æ˜¯ Producer ä¼ é€’æ¶ˆæ¯å’Œ Consumer æå–æ¶ˆæ¯çš„ç±»åˆ«ã€‚</li> <li><strong>Message</strong> - æ˜¯è¦ä¼ é€’çš„ä¿¡æ¯ã€‚æ¶ˆæ¯å¿…é¡»æœ‰ä¸€ä¸ªä¸»é¢˜ï¼Œå¯ä»¥å°†å…¶è§£é‡Šä¸ºæ‚¨è¦å‘é€ç»™çš„é‚®ä»¶åœ°å€ã€‚æ¶ˆæ¯è¿˜å¯ä»¥å…·æœ‰å¯é€‰ Tag å’Œé¢å¤–çš„é”®å€¼å¯¹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¸ºæ¶ˆæ¯è®¾ç½®ä¸šåŠ¡å¯†é’¥ï¼Œå¹¶åœ¨ä»£ç†æœåŠ¡å™¨ä¸ŠæŸ¥æ‰¾æ¶ˆæ¯ä»¥è¯Šæ–­å¼€å‘æœŸé—´çš„é—®é¢˜ã€‚
<ul><li><strong>Message Queue</strong> - ä¸»é¢˜è¢«åˆ’åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå­ä¸»é¢˜â€œæ¶ˆæ¯é˜Ÿåˆ—â€ã€‚</li> <li><strong>Tag</strong> - å³å­ä¸»é¢˜ï¼Œä¸ºç”¨æˆ·æä¾›äº†é¢å¤–çš„çµæ´»æ€§ã€‚å¯¹äº Tagï¼Œæ¥è‡ªåŒä¸€ä¸šåŠ¡æ¨¡å—çš„å…·æœ‰ä¸åŒç›®çš„çš„æ¶ˆæ¯å¯ä»¥å…·æœ‰ç›¸åŒçš„ä¸»é¢˜å’Œä¸åŒçš„ Tagã€‚</li></ul></li></ul> <h2 id="å®‰è£…"><a href="#å®‰è£…" class="header-anchor">#</a> å®‰è£…</h2> <h3 id="ç¯å¢ƒè¦æ±‚"><a href="#ç¯å¢ƒè¦æ±‚" class="header-anchor">#</a> ç¯å¢ƒè¦æ±‚</h3> <ul><li>æ¨è 64 ä½æ“ä½œç³»ç»Ÿï¼šLinux/Unix/Mac</li> <li>64bit JDK 1.8+</li> <li>Maven 3.2.x</li> <li>Git</li></ul> <h3 id="ä¸‹è½½è§£å‹"><a href="#ä¸‹è½½è§£å‹" class="header-anchor">#</a> ä¸‹è½½è§£å‹</h3> <p>è¿›å…¥å®˜æ–¹ä¸‹è½½åœ°å€ï¼š<a href="https://rocketmq.apache.org/dowloading/releases/%EF%BC%8C%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%89%88%E6%9C%AC" target="_blank" rel="noopener noreferrer">https://rocketmq.apache.org/dowloading/releases/ï¼Œé€‰æ‹©åˆé€‚ç‰ˆæœ¬<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>å»ºè®®é€‰æ‹© binary ç‰ˆæœ¬ã€‚</p> <p>è§£å‹åˆ°æœ¬åœ°ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">unzip</span> rocketmq-all-4.2.0-source-release.zip
<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> rocketmq-all-4.2.0/
</code></pre></div><h3 id="å¯åŠ¨-name-server"><a href="#å¯åŠ¨-name-server" class="header-anchor">#</a> å¯åŠ¨ Name Server</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">nohup</span> <span class="token function">sh</span> bin/mqnamesrv <span class="token operator">&amp;</span>
<span class="token operator">&gt;</span> <span class="token function">tail</span> -f ~/logs/rocketmqlogs/namesrv.log
The Name Server boot success<span class="token punctuation">..</span>.
</code></pre></div><h3 id="å¯åŠ¨-broker"><a href="#å¯åŠ¨-broker" class="header-anchor">#</a> å¯åŠ¨ Broker</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">nohup</span> <span class="token function">sh</span> bin/mqbroker -n localhost:9876 -c conf/broker.conf <span class="token operator">&amp;</span>
<span class="token operator">&gt;</span> <span class="token function">tail</span> -f ~/logs/rocketmqlogs/broker.log
The broker<span class="token punctuation">[</span>%s, <span class="token number">172.30</span>.30.233:10911<span class="token punctuation">]</span> boot success<span class="token punctuation">..</span>.
</code></pre></div><h3 id="æ”¶å‘æ¶ˆæ¯"><a href="#æ”¶å‘æ¶ˆæ¯" class="header-anchor">#</a> æ”¶å‘æ¶ˆæ¯</h3> <p>æ‰§è¡Œæ”¶å‘æ¶ˆæ¯æ“ä½œä¹‹å‰ï¼Œä¸è®¸å‘Šè¯‰å®¢æˆ·ç«¯å‘½åæœåŠ¡å™¨çš„ä½ç½®ã€‚åœ¨ RocketMQ ä¸­æœ‰å¤šç§æ–¹æ³•æ¥å®ç°è¿™ä¸ªç›®çš„ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€ç®€å•çš„æ–¹æ³•â€”â€”è®¾ç½®ç¯å¢ƒå˜é‡ <code>NAMESRV_ADDR</code> ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">NAMESRV_ADDR</span><span class="token operator">=</span>localhost:9876
<span class="token operator">&gt;</span> <span class="token function">sh</span> bin/tools.sh org.apache.rocketmq.example.quickstart.Producer
SendResult <span class="token punctuation">[</span>sendStatus<span class="token operator">=</span>SEND_OK, <span class="token assign-left variable">msgId</span><span class="token operator">=</span> <span class="token punctuation">..</span>.

<span class="token operator">&gt;</span> <span class="token function">sh</span> bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer
ConsumeMessageThread_%d Receive New Messages: <span class="token punctuation">[</span>MessageExt<span class="token punctuation">..</span>.
</code></pre></div><h3 id="å…³é—­æœåŠ¡å™¨"><a href="#å…³é—­æœåŠ¡å™¨" class="header-anchor">#</a> å…³é—­æœåŠ¡å™¨</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sh</span> bin/mqshutdown broker
The mqbroker<span class="token punctuation">(</span><span class="token number">36695</span><span class="token punctuation">)</span> is running<span class="token punctuation">..</span>.
Send <span class="token function">shutdown</span> request to mqbroker<span class="token punctuation">(</span><span class="token number">36695</span><span class="token punctuation">)</span> OK

<span class="token operator">&gt;</span> <span class="token function">sh</span> bin/mqshutdown namesrv
The mqnamesrv<span class="token punctuation">(</span><span class="token number">36664</span><span class="token punctuation">)</span> is running<span class="token punctuation">..</span>.
Send <span class="token function">shutdown</span> request to mqnamesrv<span class="token punctuation">(</span><span class="token number">36664</span><span class="token punctuation">)</span> OK
</code></pre></div><h2 id="api"><a href="#api" class="header-anchor">#</a> API</h2> <p>é¦–å…ˆåœ¨é¡¹ç›®ä¸­å¼•å…¥ maven ä¾èµ–ï¼š</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="producer"><a href="#producer" class="header-anchor">#</a> Producer</h3> <p>Producer åœ¨ RocketMQ ä¸­è´Ÿè´£å‘é€æ¶ˆæ¯ã€‚</p> <p>RocketMQ æœ‰ä¸‰ç§æ¶ˆæ¯å‘é€æ–¹å¼ï¼š</p> <ul><li>å¯é çš„åŒæ­¥å‘é€</li> <li>å¯é çš„å¼‚æ­¥å‘é€</li> <li>å•é¡¹å‘é€</li></ul> <h4 id="å¯é çš„åŒæ­¥å‘é€"><a href="#å¯é çš„åŒæ­¥å‘é€" class="header-anchor">#</a> å¯é çš„åŒæ­¥å‘é€</h4> <p>å¯é çš„åŒæ­¥ä¼ è¾“ç”¨äºå¹¿æ³›çš„åœºæ™¯ï¼Œå¦‚é‡è¦çš„é€šçŸ¥æ¶ˆæ¯ï¼ŒçŸ­ä¿¡é€šçŸ¥ï¼ŒçŸ­ä¿¡è¥é”€ç³»ç»Ÿç­‰ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SyncProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//Instantiate with a producer group name.</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span>
            <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;please_rename_unique_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Launch the instance.</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Create a message instance, specifying topic, tag and message body.</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
                <span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span>
                    i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//Call send message to deliver message to one of brokers.</span>
            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%n&quot;</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//Shut down once the producer instance is not longer in use.</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="å¯é çš„å¼‚æ­¥å‘é€"><a href="#å¯é çš„å¼‚æ­¥å‘é€" class="header-anchor">#</a> å¯é çš„å¼‚æ­¥å‘é€</h4> <p>å¼‚æ­¥ä¼ è¾“é€šå¸¸ç”¨äºå“åº”æ—¶é—´æ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//Instantiate with a producer group name.</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleProducerGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Launch the instance.</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendAsyncFailed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span>
                <span class="token comment">//Create a message instance, specifying topic, tag and message body.</span>
                <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;TagA&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;OrderID188&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d OK %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                            sendResult<span class="token punctuation">.</span><span class="token function">getMsgId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d Exception %s %n&quot;</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//Shut down once the producer instance is not longer in use.</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="å•å‘ä¼ è¾“"><a href="#å•å‘ä¼ è¾“" class="header-anchor">#</a> å•å‘ä¼ è¾“</h4> <p>å•å‘ä¼ è¾“ç”¨äºéœ€è¦ä¸­ç­‰å¯é æ€§çš„æƒ…å†µï¼Œä¾‹å¦‚æ—¥å¿—æ”¶é›†ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnewayProducer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//Instantiate with a producer group name.</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;ExampleProducerGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Launch the instance.</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Create a message instance, specifying topic, tag and message body.</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span> <span class="token comment">/* Topic */</span><span class="token punctuation">,</span>
                <span class="token string">&quot;TagA&quot;</span> <span class="token comment">/* Tag */</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">&quot;Hello RocketMQ &quot;</span> <span class="token operator">+</span>
                    i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span>DEFAULT_CHARSET<span class="token punctuation">)</span> <span class="token comment">/* Message body */</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//Call send message to deliver message to one of brokers.</span>
            producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token comment">//Shut down once the producer instance is not longer in use.</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="consumer"><a href="#consumer" class="header-anchor">#</a> Consumer</h3> <p>Consumer åœ¨ RocketMQ ä¸­è´Ÿè´£æ¥æ”¶æ¶ˆæ¯ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderedConsumer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;example_group_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token class-name">RocketConfig</span><span class="token punctuation">.</span>HOST<span class="token punctuation">)</span><span class="token punctuation">;</span>

        consumer<span class="token punctuation">.</span><span class="token function">setConsumeFromWhere</span><span class="token punctuation">(</span><span class="token class-name">ConsumeFromWhere</span><span class="token punctuation">.</span>CONSUME_FROM_FIRST_OFFSET<span class="token punctuation">)</span><span class="token punctuation">;</span>

        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;TopicTest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TagA || TagC || TagD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerOrderly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">AtomicLong</span> consumeTimes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeOrderlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> msgs<span class="token punctuation">,</span>
                <span class="token class-name">ConsumeOrderlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                context<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; Receive New Messages: &quot;</span> <span class="token operator">+</span> msgs <span class="token operator">+</span> <span class="token string">&quot;%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>consumeTimes<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>consumeTimes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>consumeTimes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span>ROLLBACK<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>consumeTimes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span>COMMIT<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>consumeTimes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    context<span class="token punctuation">.</span><span class="token function">setSuspendCurrentQueueTimeMillis</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span>SUSPEND_CURRENT_QUEUE_A_MOMENT<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer Started.%n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="faq"><a href="#faq" class="header-anchor">#</a> FAQ</h3> <h4 id="connect-to-172-17-0-1-10909-failed"><a href="#connect-to-172-17-0-1-10909-failed" class="header-anchor">#</a> connect to <code>&lt;172.17.0.1:10909&gt;</code> failed</h4> <p>å¯åŠ¨åï¼ŒProducer å®¢æˆ·ç«¯è¿æ¥ RocketMQ æ—¶æŠ¥é”™ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>exception<span class="token punctuation">.</span><span class="token class-name">RemotingConnectException</span><span class="token operator">:</span> connect <span class="token keyword">to</span> <span class="token operator">&lt;</span><span class="token number">172.17</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">10909</span><span class="token operator">&gt;</span> failed
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>netty<span class="token punctuation">.</span><span class="token class-name">NettyRemotingClient</span><span class="token punctuation">.</span><span class="token function">invokeSync</span><span class="token punctuation">(</span><span class="token class-name">NettyRemotingClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">357</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span><span class="token class-name">MQClientAPIImpl</span><span class="token punctuation">.</span><span class="token function">sendMessageSync</span><span class="token punctuation">(</span><span class="token class-name">MQClientAPIImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">343</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span><span class="token class-name">MQClientAPIImpl</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">MQClientAPIImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">327</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span><span class="token class-name">MQClientAPIImpl</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">MQClientAPIImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">290</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>producer<span class="token punctuation">.</span><span class="token class-name">DefaultMQProducerImpl</span><span class="token punctuation">.</span><span class="token function">sendKernelImpl</span><span class="token punctuation">(</span><span class="token class-name">DefaultMQProducerImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">688</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>producer<span class="token punctuation">.</span><span class="token class-name">DefaultMQProducerImpl</span><span class="token punctuation">.</span><span class="token function">sendSelectImpl</span><span class="token punctuation">(</span><span class="token class-name">DefaultMQProducerImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">901</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>producer<span class="token punctuation">.</span><span class="token class-name">DefaultMQProducerImpl</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">DefaultMQProducerImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">878</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>producer<span class="token punctuation">.</span><span class="token class-name">DefaultMQProducerImpl</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">DefaultMQProducerImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">873</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span><span class="token class-name">DefaultMQProducer</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">DefaultMQProducer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">369</span><span class="token punctuation">)</span>
    at com<span class="token punctuation">.</span>emrubik<span class="token punctuation">.</span>uc<span class="token punctuation">.</span>mdm<span class="token punctuation">.</span>sync<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token class-name">MdmInit</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">MdmInit</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>
    at com<span class="token punctuation">.</span>emrubik<span class="token punctuation">.</span>uc<span class="token punctuation">.</span>mdm<span class="token punctuation">.</span>sync<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token class-name">MdmInit</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">MdmInit</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2149</span><span class="token punctuation">)</span>
</code></pre></div><p>åŸå› ï¼šRocketMQ éƒ¨ç½²åœ¨è™šæ‹Ÿæœºä¸Šï¼Œå†…ç½‘ ip ä¸º 10.10.30.63ï¼Œè¯¥è™šæ‹Ÿæœºä¸€ä¸ª docker0 ç½‘å¡ï¼Œip ä¸º 172.17.0.1ã€‚RocketMQ broker å¯åŠ¨æ—¶é»˜è®¤ä½¿ç”¨äº† docker0 ç½‘å¡ï¼ŒProducer å®¢æˆ·ç«¯æ— æ³•è¿æ¥ 172.17.0.1ï¼Œé€ æˆä»¥ä¸Šé—®é¢˜ã€‚</p> <p>è§£å†³æ–¹æ¡ˆ</p> <p>ï¼ˆ1ï¼‰å¹²æ‰ docker0 ç½‘å¡æˆ–ä¿®æ”¹ç½‘å¡åç§°</p> <p>ï¼ˆ2ï¼‰åœæ‰ brokerï¼Œä¿®æ”¹ broker é…ç½®æ–‡ä»¶ï¼Œé‡å¯ brokerã€‚</p> <p>ä¿®æ”¹ conf/broker.confï¼Œå¢åŠ ä¸¤è¡Œæ¥æŒ‡å®šå¯åŠ¨ broker çš„ IPï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>namesrvAddr = 10.10.30.63:9876
brokerIP1 = 10.10.30.63
</code></pre></div><p>å¯åŠ¨æ—¶éœ€è¦æŒ‡å®šé…ç½®æ–‡ä»¶</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">nohup</span> <span class="token function">sh</span> bin/mqbroker -n localhost:9876 -c conf/broker.conf <span class="token operator">&amp;</span>
</code></pre></div><h2 id="æ¶æ„"><a href="#æ¶æ„" class="header-anchor">#</a> æ¶æ„</h2> <div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/distributed/mq/rocketmq/rmq-basic-arc.png!zp"></div>RocketMQ ç”±å››éƒ¨åˆ†ç»„æˆï¼šNameServerã€Brokerã€Producerã€Consumerã€‚å…¶ä¸­ä»»æ„ä¸€ä¸ªç»„æˆéƒ½å¯ä»¥æ°´å¹³æ‰©å±•ä¸ºé›†ç¾¤æ¨¡å¼ï¼Œä»¥é¿å…å•ç‚¹æ•…éšœé—®é¢˜ã€‚<p></p> <h3 id="nameserver"><a href="#nameserver" class="header-anchor">#</a> NameServer</h3> <p>NameServer æä¾›è½»é‡çº§çš„æœåŠ¡å‘ç°å’Œè·¯ç”±èƒ½åŠ›ã€‚æ¯ä¸ª NameServer èŠ‚ç‚¹è®°å½•å…¨éƒ¨çš„è·¯ç”±ä¿¡æ¯ï¼Œæ”¯æŒç›¸åº”çš„è¯»å†™æ“ä½œï¼Œå¹¶æ”¯æŒå¿«é€Ÿå­˜å‚¨æ‰©å±•ã€‚</p> <p>NameServer æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„æœåŠ¡å™¨ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªåŠŸèƒ½ï¼š</p> <ol><li>Broker ç®¡ç† - NameServer æ¥å—æ¥è‡ª Broker é›†ç¾¤çš„æ³¨å†Œï¼Œå¹¶æä¾›å¿ƒè·³æœºåˆ¶æ¥æ£€æŸ¥ Broker èŠ‚ç‚¹æ˜¯å¦å­˜æ´»ã€‚</li> <li>è·¯ç”±ç®¡ç† - æ¯ä¸ª NameServer å°†ä¿å­˜æœ‰å…³ Broker é›†ç¾¤çš„å®Œæ•´è·¯ç”±ä¿¡æ¯å’Œå®¢æˆ·ç«¯æŸ¥è¯¢çš„æŸ¥è¯¢é˜Ÿåˆ—ã€‚</li></ol> <p>RocketMQ å®¢æˆ·ç«¯ï¼ˆProducer/Consumerï¼‰å°†ä» NameServer æŸ¥è¯¢é˜Ÿåˆ—è·¯ç”±ä¿¡æ¯ã€‚</p> <p>å°† NameServer åœ°å€åˆ—è¡¨æä¾›ç»™å®¢æˆ·ç«¯æœ‰å››ç§æ–¹æ³•ï¼š</p> <ol><li>ç¼–ç¨‹æ–¹å¼ - ç±»ä¼¼ï¼š<code>producer.setNamesrvAddr(&quot;ip:port&quot;)</code></li> <li>Java é€‰é¡¹ - ä½¿ç”¨ <code>rocketmq.namesrv.addr</code> å‚æ•°</li> <li>ç¯å¢ƒå˜é‡ - è®¾ç½®ç¯å¢ƒå˜é‡ <code>NAMESRV_ADDR</code></li> <li>HTTP ç«¯ç‚¹</li></ol> <blockquote><p>æ›´è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="http://rocketmq.apache.org/rocketmq/four-methods-to-feed-name-server-address-list/" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="broker"><a href="#broker" class="header-anchor">#</a> Broker</h3> <p>Broker é€šè¿‡æä¾›è½»é‡çº§çš„ TOPIC å’Œ QUEUE æœºåˆ¶æ¥å¤„ç†æ¶ˆæ¯å­˜å‚¨ã€‚å®ƒä»¬æ”¯æŒ Push å’Œ Pull æ¨¡å‹ï¼ŒåŒ…å«å®¹é”™æœºåˆ¶ï¼ˆ2 ä¸ªå‰¯æœ¬æˆ– 3 ä¸ªå‰¯æœ¬ï¼‰ï¼Œå¹¶æä¾›å¼ºå¤§çš„å³°å€¼å¡«å……å’Œä»¥åŸå§‹æ—¶é—´é¡ºåºç´¯ç§¯æ•°åƒäº¿æ¡æ¶ˆæ¯çš„èƒ½åŠ›ã€‚æ­¤å¤–ï¼ŒBrokers è¿˜æä¾›ç¾éš¾æ¢å¤ï¼Œä¸°å¯Œçš„æŒ‡æ ‡ç»Ÿè®¡å’Œè­¦æŠ¥æœºåˆ¶ã€‚</p> <p>Broker æœ‰å‡ ä¸ªé‡è¦çš„å­æ¨¡å—ï¼š</p> <ul><li>Remoting Module - å³ä»£ç†çš„æ¡ç›®ï¼Œå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</li> <li>Client Manager - ç®¡ç†å®¢æˆ·ï¼ˆç”Ÿäº§è€…/æ¶ˆè´¹è€…ï¼‰å¹¶ç»´æŠ¤æ¶ˆè´¹è€…çš„ä¸»é¢˜è®¢é˜…ã€‚</li> <li>Store æœåŠ¡ - æä¾›ç®€å•çš„ API æ¥å­˜å‚¨æˆ–æŸ¥è¯¢ç‰©ç†ç£ç›˜ä¸­çš„æ¶ˆæ¯ã€‚</li> <li>HA æœåŠ¡ - æä¾›ä¸»ä»£ç†å’Œä»ä»£ç†ä¹‹é—´çš„æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚</li> <li>Index æœåŠ¡ - æŒ‰æŒ‡å®šå¯†é’¥æ„å»ºæ¶ˆæ¯ç´¢å¼•ï¼Œå¹¶æä¾›å¿«é€Ÿæ¶ˆæ¯æŸ¥è¯¢ã€‚</li></ul> <div align="center"><img src="http://dunwu.test.upcdn.net/cs/java/javaweb/distributed/mq/rocketmq/rmq-basic-component.png!zp"></div> <h3 id="producer-2"><a href="#producer-2" class="header-anchor">#</a> Producer</h3> <p>Producers æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ã€‚Distributed Producers é€šè¿‡å¤šç§è´Ÿè½½å‡è¡¡æ¨¡å¼å‘ Broker é›†ç¾¤å‘é€æ¶ˆæ¯ã€‚å‘é€è¿‡ç¨‹æ”¯æŒå¿«é€Ÿæ•…éšœå¹¶å…·æœ‰ä½å»¶è¿Ÿã€‚</p> <h3 id="consumer-2"><a href="#consumer-2" class="header-anchor">#</a> Consumer</h3> <p>Consumer ä¹Ÿæ”¯æŒ Push å’Œ Pull æ¨¡å‹ä¸­çš„åˆ†å¸ƒå¼éƒ¨ç½²ã€‚å®ƒè¿˜æ”¯æŒç¾¤é›†æ¶ˆè´¹å’Œæ¶ˆæ¯å¹¿æ’­ã€‚å®ƒæä¾›å®æ—¶æ¶ˆæ¯è®¢é˜…æœºåˆ¶ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°æ¶ˆè´¹è€…çš„éœ€æ±‚ã€‚ RocketMQ çš„ç½‘ç«™ä¸ºæ„Ÿå…´è¶£çš„ç”¨æˆ·æä¾›äº†ä¸€ä¸ªç®€å•çš„å¿«é€Ÿå…¥é—¨æŒ‡å—ã€‚</p> <h2 id="åŸç†"><a href="#åŸç†" class="header-anchor">#</a> åŸç†</h2> <p>åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿä½œä¸ºå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿå¯æ‰©å±•ã€å¯ä¼¸ç¼©æ€§çš„å…³é”®ç»„ä»¶ï¼Œéœ€è¦å…·æœ‰é«˜ååé‡ã€é«˜å¯ç”¨ç­‰ç‰¹ç‚¹ã€‚è€Œè°ˆåˆ°æ¶ˆæ¯ç³»ç»Ÿçš„è®¾è®¡ï¼Œå°±å›é¿ä¸äº†ä¸¤ä¸ªé—®é¢˜ï¼š</p> <ol><li>æ¶ˆæ¯çš„é¡ºåºé—®é¢˜</li> <li>æ¶ˆæ¯çš„é‡å¤é—®é¢˜</li></ol> <h3 id="é¡ºåºæ¶ˆæ¯"><a href="#é¡ºåºæ¶ˆæ¯" class="header-anchor">#</a> é¡ºåºæ¶ˆæ¯</h3> <h4 id="ç¬¬ä¸€ç§æ¨¡å‹"><a href="#ç¬¬ä¸€ç§æ¨¡å‹" class="header-anchor">#</a> ç¬¬ä¸€ç§æ¨¡å‹</h4> <p>å‡å¦‚ç”Ÿäº§è€…äº§ç”Ÿäº† 2 æ¡æ¶ˆæ¯ï¼šM1ã€M2ï¼Œè¦ä¿è¯è¿™ä¸¤æ¡æ¶ˆæ¯çš„é¡ºåºï¼Œåº”è¯¥æ€æ ·åšï¼Ÿä½ è„‘ä¸­æƒ³åˆ°çš„å¯èƒ½æ˜¯è¿™æ ·ï¼š</p> <div align="center"><img src="http://upload-images.jianshu.io/upload_images/3101171-bb5ec534363e2fb4"></div> <p>å‡å®š M1 å‘é€åˆ° S1ï¼ŒM2 å‘é€åˆ° S2ï¼Œå¦‚æœè¦ä¿è¯ M1 å…ˆäº M2 è¢«æ¶ˆè´¹ï¼Œé‚£ä¹ˆéœ€è¦ M1 åˆ°è¾¾æ¶ˆè´¹ç«¯è¢«æ¶ˆè´¹åï¼Œé€šçŸ¥ S2ï¼Œç„¶å S2 å†å°† M2 å‘é€åˆ°æ¶ˆè´¹ç«¯ã€‚</p> <p>è¿™ä¸ªæ¨¡å‹å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœ M1 å’Œ M2 åˆ†åˆ«å‘é€åˆ°ä¸¤å° Server ä¸Šï¼Œå°±ä¸èƒ½ä¿è¯ M1 å…ˆè¾¾åˆ° MQ é›†ç¾¤ï¼Œä¹Ÿä¸èƒ½ä¿è¯ M1 è¢«å…ˆæ¶ˆè´¹ã€‚æ¢ä¸ªè§’åº¦çœ‹ï¼Œå¦‚æœ M2 å…ˆäº M1 è¾¾åˆ° MQ é›†ç¾¤ï¼Œç”šè‡³ M2 è¢«æ¶ˆè´¹åï¼ŒM1 æ‰è¾¾åˆ°æ¶ˆè´¹ç«¯ï¼Œè¿™æ—¶æ¶ˆæ¯ä¹Ÿå°±ä¹±åºäº†ï¼Œè¯´æ˜ä»¥ä¸Šæ¨¡å‹æ˜¯ä¸èƒ½ä¿è¯æ¶ˆæ¯çš„é¡ºåºçš„ã€‚</p> <div align="center"><img src="http://upload-images.jianshu.io/upload_images/3101171-5a6313fe906a678b"></div> <h4 id="ç¬¬äºŒç§æ¨¡å‹"><a href="#ç¬¬äºŒç§æ¨¡å‹" class="header-anchor">#</a> ç¬¬äºŒç§æ¨¡å‹</h4> <p>å¦‚ä½•æ‰èƒ½åœ¨ MQ é›†ç¾¤ä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Ÿä¸€ç§ç®€å•çš„æ–¹å¼å°±æ˜¯å°† M1ã€M2 å‘é€åˆ°åŒä¸€ä¸ª Server ä¸Šï¼š</p> <p>è¿™æ ·å¯ä»¥ä¿è¯ M1 å…ˆäº M2 åˆ°è¾¾ MQServerï¼ˆç”Ÿäº§è€…ç­‰å¾… M1 å‘é€æˆåŠŸåå†å‘é€ M2ï¼‰ï¼Œæ ¹æ®å…ˆè¾¾åˆ°å…ˆè¢«æ¶ˆè´¹çš„åŸåˆ™ï¼ŒM1 ä¼šå…ˆäº M2 è¢«æ¶ˆè´¹ï¼Œè¿™æ ·å°±ä¿è¯äº†æ¶ˆæ¯çš„é¡ºåºã€‚</p> <p>è¿™ä¸ªæ¨¡å‹ä¹Ÿä»…ä»…æ˜¯ç†è®ºä¸Šå¯ä»¥ä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Œåœ¨å®é™…åœºæ™¯ä¸­å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢çš„é—®é¢˜ï¼š</p> <div align="center"><img src="http://upload-images.jianshu.io/upload_images/3101171-d430f5a3ec6c48ad"></div> <p>åªè¦å°†æ¶ˆæ¯ä»ä¸€å°æœåŠ¡å™¨å‘å¾€å¦ä¸€å°æœåŠ¡å™¨ï¼Œå°±ä¼šå­˜åœ¨ç½‘ç»œå»¶è¿Ÿé—®é¢˜ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¦‚æœå‘é€ M1 è€—æ—¶å¤§äºå‘é€ M2 çš„è€—æ—¶ï¼Œé‚£ä¹ˆ M2 å°±ä»å°†è¢«å…ˆæ¶ˆè´¹ï¼Œä»ç„¶ä¸èƒ½ä¿è¯æ¶ˆæ¯çš„é¡ºåºã€‚å³ä½¿ M1 å’Œ M2 åŒæ—¶åˆ°è¾¾æ¶ˆè´¹ç«¯ï¼Œç”±äºä¸æ¸…æ¥šæ¶ˆè´¹ç«¯ 1 å’Œæ¶ˆè´¹ç«¯ 2 çš„è´Ÿè½½æƒ…å†µï¼Œä»ç„¶æœ‰å¯èƒ½å‡ºç° M2 å…ˆäº M1 è¢«æ¶ˆè´¹çš„æƒ…å†µã€‚</p> <p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿå°† M1 å’Œ M2 å‘å¾€åŒä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸”å‘é€ M1 åï¼Œéœ€è¦æ¶ˆè´¹ç«¯å“åº”æˆåŠŸåæ‰èƒ½å‘é€ M2ã€‚</p> <p>è¿™å¯èƒ½äº§ç”Ÿå¦å¤–çš„é—®é¢˜ï¼šå¦‚æœ M1 è¢«å‘é€åˆ°æ¶ˆè´¹ç«¯åï¼Œæ¶ˆè´¹ç«¯ 1 æ²¡æœ‰å“åº”ï¼Œé‚£æ˜¯ç»§ç»­å‘é€ M2 å‘¢ï¼Œè¿˜æ˜¯é‡æ–°å‘é€ M1ï¼Ÿä¸€èˆ¬ä¸ºäº†ä¿è¯æ¶ˆæ¯ä¸€å®šè¢«æ¶ˆè´¹ï¼Œè‚¯å®šä¼šé€‰æ‹©é‡å‘ M1 åˆ°å¦å¤–ä¸€ä¸ªæ¶ˆè´¹ç«¯ 2ï¼Œå°±å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p> <div align="center"><img src="http://upload-images.jianshu.io/upload_images/3101171-3c0e822d37a85e1e"></div> <p>è¿™æ ·çš„æ¨¡å‹å°±ä¸¥æ ¼ä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Œç»†å¿ƒçš„ä½ ä»ç„¶ä¼šå‘ç°é—®é¢˜ï¼Œæ¶ˆè´¹ç«¯ 1 æ²¡æœ‰å“åº” Server æ—¶æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ M1 ç¡®å®æ²¡æœ‰åˆ°è¾¾(æ•°æ®åœ¨ç½‘ç»œä¼ é€ä¸­ä¸¢å¤±)ï¼Œå¦å¤–ä¸€ç§æ¶ˆè´¹ç«¯å·²ç»æ¶ˆè´¹ M1 ä¸”å·²ç»å‘é€å“åº”æ¶ˆæ¯ï¼Œåªæ˜¯ MQ Server ç«¯æ²¡æœ‰æ”¶åˆ°ã€‚å¦‚æœæ˜¯ç¬¬äºŒç§æƒ…å†µï¼Œé‡å‘ M1ï¼Œå°±ä¼šé€ æˆ M1 è¢«é‡å¤æ¶ˆè´¹ã€‚ä¹Ÿå°±å¼•å…¥äº†æˆ‘ä»¬è¦è¯´çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæ¶ˆæ¯é‡å¤é—®é¢˜ï¼Œè¿™ä¸ªåæ–‡ä¼šè¯¦ç»†è®²è§£ã€‚</p> <p>å›è¿‡å¤´æ¥çœ‹æ¶ˆæ¯é¡ºåºé—®é¢˜ï¼Œä¸¥æ ¼çš„é¡ºåºæ¶ˆæ¯éå¸¸å®¹æ˜“ç†è§£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ–‡ä¸­æ‰€æè¿°çš„æ–¹å¼æ¥ç®€å•å¤„ç†ã€‚æ€»ç»“èµ·æ¥ï¼Œè¦å®ç°ä¸¥æ ¼çš„é¡ºåºæ¶ˆæ¯ï¼Œç®€å•ä¸”å¯è¡Œçš„åŠæ³•å°±æ˜¯ï¼š</p> <p><strong>ä¿è¯ç”Ÿäº§è€… - MQServer - æ¶ˆè´¹è€…æ˜¯ä¸€å¯¹ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚</strong></p> <p>è¿™æ ·çš„è®¾è®¡è™½ç„¶ç®€å•æ˜“è¡Œï¼Œä½†ä¹Ÿä¼šå­˜åœ¨ä¸€äº›å¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p> <ol><li>å¹¶è¡Œåº¦å°±ä¼šæˆä¸ºæ¶ˆæ¯ç³»ç»Ÿçš„ç“¶é¢ˆï¼ˆååé‡ä¸å¤Ÿï¼‰</li> <li>æ›´å¤šçš„å¼‚å¸¸å¤„ç†ï¼Œæ¯”å¦‚ï¼šåªè¦æ¶ˆè´¹ç«¯å‡ºç°é—®é¢˜ï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªå¤„ç†æµç¨‹é˜»å¡ï¼Œæˆ‘ä»¬ä¸å¾—ä¸èŠ±è´¹æ›´å¤šçš„ç²¾åŠ›æ¥è§£å†³é˜»å¡çš„é—®é¢˜ã€‚</li></ol> <p>RocketMQ çš„è§£å†³æ–¹æ¡ˆï¼šé€šè¿‡åˆç†çš„è®¾è®¡æˆ–è€…å°†é—®é¢˜åˆ†è§£æ¥è§„é¿ã€‚å¦‚æœç¡¬è¦æŠŠæ—¶é—´èŠ±åœ¨è§£å†³é—®é¢˜æœ¬èº«ï¼Œå®é™…ä¸Šä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”ä¹Ÿæ˜¯ä¸€ç§æµªè´¹ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹æ¶ˆæ¯çš„é¡ºåºé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸¤ä¸ªç»“è®ºï¼š</p> <ol><li>ä¸å…³æ³¨ä¹±åºçš„åº”ç”¨å®é™…å¤§é‡å­˜åœ¨</li> <li>é˜Ÿåˆ—æ— åºå¹¶ä¸æ„å‘³ç€æ¶ˆæ¯æ— åº</li></ol> <p>æœ€åæˆ‘ä»¬ä»æºç è§’åº¦åˆ†æ RocketMQ æ€ä¹ˆå®ç°å‘é€é¡ºåºæ¶ˆæ¯ã€‚</p> <p>RocketMQ é€šè¿‡è½®è¯¢æ‰€æœ‰é˜Ÿåˆ—çš„æ–¹å¼æ¥ç¡®å®šæ¶ˆæ¯è¢«å‘é€åˆ°å“ªä¸€ä¸ªé˜Ÿåˆ—ï¼ˆè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰ã€‚æ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œè®¢å•å·ç›¸åŒçš„æ¶ˆæ¯ä¼šè¢«å…ˆåå‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// RocketMQ é€šè¿‡ MessageQueueSelector ä¸­å®ç°çš„ç®—æ³•æ¥ç¡®å®šæ¶ˆæ¯å‘é€åˆ°å“ªä¸€ä¸ªé˜Ÿåˆ—ä¸Š</span>
<span class="token comment">// RocketMQ é»˜è®¤æä¾›äº†ä¸¤ç§ MessageQueueSelector å®ç°ï¼šéšæœº/Hash</span>
<span class="token comment">// å½“ç„¶ä½ å¯ä»¥æ ¹æ®ä¸šåŠ¡å®ç°è‡ªå·±çš„ MessageQueueSelector æ¥å†³å®šæ¶ˆæ¯æŒ‰ç…§ä½•ç§ç­–ç•¥å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­</span>
<span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessageQueueSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">MessageQueue</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">&gt;</span></span> mqs<span class="token punctuation">,</span> <span class="token class-name">Message</span> msg<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>
        <span class="token keyword">int</span> index <span class="token operator">=</span> id <span class="token operator">%</span> mqs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mqs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>åœ¨è·å–åˆ°è·¯ç”±ä¿¡æ¯ä»¥åï¼Œä¼šæ ¹æ® MessageQueueSelector å®ç°çš„ç®—æ³•æ¥é€‰æ‹©ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒä¸€ä¸ª OrderId è·å–åˆ°çš„è‚¯å®šæ˜¯åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">SendResult</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token comment">// è·å–topicè·¯ç”±ä¿¡æ¯</span>
    <span class="token class-name">TopicPublishInfo</span> topicPublishInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tryToFindTopicPublishInfo</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>topicPublishInfo <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> topicPublishInfo<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MessageQueue</span> mq <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// æ ¹æ®æˆ‘ä»¬çš„ç®—æ³•ï¼Œé€‰æ‹©ä¸€ä¸ªå‘é€é˜Ÿåˆ—</span>
        <span class="token comment">// è¿™é‡Œçš„arg = orderId</span>
        mq <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>topicPublishInfo<span class="token punctuation">.</span><span class="token function">getMessageQueueList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mq <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendKernelImpl</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> mq<span class="token punctuation">,</span> communicationMode<span class="token punctuation">,</span> sendCallback<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¶ˆæ¯é‡å¤"><a href="#æ¶ˆæ¯é‡å¤" class="header-anchor">#</a> æ¶ˆæ¯é‡å¤</h3> <p>é€ æˆæ¶ˆæ¯é‡å¤çš„æ ¹æœ¬åŸå› æ˜¯ï¼šç½‘ç»œä¸å¯è¾¾ã€‚åªè¦é€šè¿‡ç½‘ç»œäº¤æ¢æ•°æ®ï¼Œå°±æ— æ³•é¿å…è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å°±æ˜¯ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚é‚£ä¹ˆé—®é¢˜å°±å˜æˆäº†ï¼šå¦‚æœæ¶ˆè´¹ç«¯æ”¶åˆ°ä¸¤æ¡ä¸€æ ·çš„æ¶ˆæ¯ï¼Œåº”è¯¥æ€æ ·å¤„ç†ï¼Ÿ</p> <ol><li>æ¶ˆè´¹ç«¯å¤„ç†æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘ä¿æŒå¹‚ç­‰æ€§ã€‚</li> <li>ä¿è¯æ¯æ¡æ¶ˆæ¯éƒ½æœ‰å”¯ä¸€ç¼–å·ä¸”ä¿è¯æ¶ˆæ¯å¤„ç†æˆåŠŸä¸å»é‡è¡¨çš„æ—¥å¿—åŒæ—¶å‡ºç°ã€‚</li></ol> <p>ç¬¬ 1 æ¡å¾ˆå¥½ç†è§£ï¼Œåªè¦ä¿æŒå¹‚ç­‰æ€§ï¼Œä¸ç®¡æ¥å¤šå°‘æ¡é‡å¤æ¶ˆæ¯ï¼Œæœ€åå¤„ç†çš„ç»“æœéƒ½ä¸€æ ·ã€‚</p> <p>ç¬¬ 2 æ¡åŸç†å°±æ˜¯åˆ©ç”¨ä¸€å¼ æ—¥å¿—è¡¨æ¥è®°å½•å·²ç»å¤„ç†æˆåŠŸçš„æ¶ˆæ¯çš„ IDï¼Œå¦‚æœæ–°åˆ°çš„æ¶ˆæ¯ ID å·²ç»åœ¨æ—¥å¿—è¡¨ä¸­ï¼Œé‚£ä¹ˆå°±ä¸å†å¤„ç†è¿™æ¡æ¶ˆæ¯ã€‚</p> <p>ç¬¬ 1 æ¡è§£å†³æ–¹æ¡ˆï¼Œå¾ˆæ˜æ˜¾åº”è¯¥åœ¨æ¶ˆè´¹ç«¯å®ç°ï¼Œä¸å±äºæ¶ˆæ¯ç³»ç»Ÿè¦å®ç°çš„åŠŸèƒ½ã€‚</p> <p>ç¬¬ 2 æ¡å¯ä»¥æ¶ˆæ¯ç³»ç»Ÿå®ç°ï¼Œä¹Ÿå¯ä»¥ä¸šåŠ¡ç«¯å®ç°ã€‚æ­£å¸¸æƒ…å†µä¸‹å‡ºç°é‡å¤æ¶ˆæ¯çš„æ¦‚ç‡å…¶å®å¾ˆå°ï¼Œå¦‚æœç”±æ¶ˆæ¯ç³»ç»Ÿæ¥å®ç°çš„è¯ï¼Œè‚¯å®šä¼šå¯¹æ¶ˆæ¯ç³»ç»Ÿçš„ååé‡å’Œé«˜å¯ç”¨æœ‰å½±å“ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯ç”±ä¸šåŠ¡ç«¯è‡ªå·±å¤„ç†æ¶ˆæ¯é‡å¤çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯ RocketMQ ä¸è§£å†³æ¶ˆæ¯é‡å¤çš„é—®é¢˜çš„åŸå› ã€‚</p> <p><strong>RocketMQ ä¸ä¿è¯æ¶ˆæ¯ä¸é‡å¤ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡éœ€è¦ä¿è¯ä¸¥æ ¼çš„ä¸é‡å¤æ¶ˆæ¯ï¼Œéœ€è¦ä½ è‡ªå·±åœ¨ä¸šåŠ¡ç«¯å»é‡ã€‚</strong></p> <h3 id="äº‹åŠ¡æ¶ˆæ¯"><a href="#äº‹åŠ¡æ¶ˆæ¯" class="header-anchor">#</a> äº‹åŠ¡æ¶ˆæ¯</h3> <p>RocketMQ é™¤äº†æ”¯æŒæ™®é€šæ¶ˆæ¯ï¼Œé¡ºåºæ¶ˆæ¯ï¼Œå¦å¤–è¿˜æ”¯æŒäº‹åŠ¡æ¶ˆæ¯ã€‚</p> <p>å‡è®¾è¿™æ ·çš„åœºæ™¯ï¼š</p> <p><img src="https://upload-images.jianshu.io/upload_images/3101171-253d8bd65736694f.png" alt="img"></p> <p>å›¾ä¸­æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ˆBob è´¦æˆ·æ‰£æ¬¾ï¼‰å’Œå‘é€å¼‚æ­¥æ¶ˆæ¯åº”è¯¥ä¿è¯åŒæ—¶æˆåŠŸæˆ–è€…åŒæ—¶å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯æ‰£æ¬¾æˆåŠŸäº†ï¼Œå‘é€æ¶ˆæ¯ä¸€å®šè¦æˆåŠŸï¼Œå¦‚æœæ‰£æ¬¾å¤±è´¥äº†ï¼Œå°±ä¸èƒ½å†å‘é€æ¶ˆæ¯ã€‚é‚£é—®é¢˜æ˜¯ï¼šæˆ‘ä»¬æ˜¯å…ˆæ‰£æ¬¾è¿˜æ˜¯å…ˆå‘é€æ¶ˆæ¯å‘¢ï¼Ÿ</p> <p><img src="http://upload-images.jianshu.io/upload_images/3101171-088dc074c4ecd192" alt="img"></p> <p>RocketMQ åˆ†å¸ƒå¼äº‹åŠ¡æ­¥éª¤ï¼š</p> <p>å‘é€ Prepared æ¶ˆæ¯ 2222222222222222222ï¼Œå¹¶æ‹¿åˆ°æ¥å—æ¶ˆæ¯çš„åœ°å€ã€‚
æ‰§è¡Œæœ¬åœ°äº‹åŠ¡
é€šè¿‡ç¬¬ 1 æ­¥éª¤æ‹¿åˆ°çš„åœ°å€å»è®¿é—®æ¶ˆæ¯ï¼Œå¹¶ä¿®æ”¹æ¶ˆæ¯çŠ¶æ€ã€‚</p> <h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="header-anchor">#</a> å‚è€ƒèµ„æ–™</h2> <ul><li><a href="http://rocketmq.apache.org/docs/quick-start/" target="_blank" rel="noopener noreferrer">RocketMQ å®˜æ–¹æ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/453c6e7ff81c" target="_blank" rel="noopener noreferrer">åˆ†å¸ƒå¼å¼€æ”¾æ¶ˆæ¯ç³»ç»Ÿ(RocketMQ)çš„åŸç†ä¸å®è·µ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/javatech/edit/master/docs/mq/rocketmq.md" target="_blank" rel="noopener noreferrer">å¸®åŠ©æˆ‘ä»¬æ”¹å–„æ­¤é¡µé¢ï¼</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/javatech/assets/js/app.fda27f19.js" defer></script><script src="/javatech/assets/js/4.712970d0.js" defer></script><script src="/javatech/assets/js/39.f7622bcc.js" defer></script>
  </body>
</html>
