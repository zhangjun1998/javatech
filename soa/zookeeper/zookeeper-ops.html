<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ZooKeeper 运维指南 | JAVATECH</title>
    <meta name="description" content="Java 教程">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/javatech/favicon.ico">
    
    <link rel="preload" href="/javatech/assets/css/0.styles.0a04ceb6.css" as="style"><link rel="preload" href="/javatech/assets/js/app.fda27f19.js" as="script"><link rel="preload" href="/javatech/assets/js/4.712970d0.js" as="script"><link rel="preload" href="/javatech/assets/js/60.c674f4b5.js" as="script"><link rel="prefetch" href="/javatech/assets/js/10.27a69910.js"><link rel="prefetch" href="/javatech/assets/js/11.9a90a5e0.js"><link rel="prefetch" href="/javatech/assets/js/12.82ee8f23.js"><link rel="prefetch" href="/javatech/assets/js/13.01fa60c7.js"><link rel="prefetch" href="/javatech/assets/js/14.289ce03a.js"><link rel="prefetch" href="/javatech/assets/js/15.20146332.js"><link rel="prefetch" href="/javatech/assets/js/16.31002576.js"><link rel="prefetch" href="/javatech/assets/js/17.91db155d.js"><link rel="prefetch" href="/javatech/assets/js/18.beb24a84.js"><link rel="prefetch" href="/javatech/assets/js/19.9b63c8bd.js"><link rel="prefetch" href="/javatech/assets/js/20.7b3dd7ca.js"><link rel="prefetch" href="/javatech/assets/js/21.32da2e20.js"><link rel="prefetch" href="/javatech/assets/js/22.e98e166c.js"><link rel="prefetch" href="/javatech/assets/js/23.2de495ed.js"><link rel="prefetch" href="/javatech/assets/js/24.934d13fa.js"><link rel="prefetch" href="/javatech/assets/js/25.d8a9ef4b.js"><link rel="prefetch" href="/javatech/assets/js/26.3e60b6e9.js"><link rel="prefetch" href="/javatech/assets/js/27.03a4cf85.js"><link rel="prefetch" href="/javatech/assets/js/28.85c4983b.js"><link rel="prefetch" href="/javatech/assets/js/29.cfb40647.js"><link rel="prefetch" href="/javatech/assets/js/30.b4406b0c.js"><link rel="prefetch" href="/javatech/assets/js/31.721e5fce.js"><link rel="prefetch" href="/javatech/assets/js/32.61d9d888.js"><link rel="prefetch" href="/javatech/assets/js/33.2e2c17a0.js"><link rel="prefetch" href="/javatech/assets/js/34.a0f94a57.js"><link rel="prefetch" href="/javatech/assets/js/35.609e175d.js"><link rel="prefetch" href="/javatech/assets/js/36.650baca2.js"><link rel="prefetch" href="/javatech/assets/js/37.59188234.js"><link rel="prefetch" href="/javatech/assets/js/38.c3e47159.js"><link rel="prefetch" href="/javatech/assets/js/39.f7622bcc.js"><link rel="prefetch" href="/javatech/assets/js/40.bf0b8425.js"><link rel="prefetch" href="/javatech/assets/js/41.f86852ed.js"><link rel="prefetch" href="/javatech/assets/js/42.058e48bd.js"><link rel="prefetch" href="/javatech/assets/js/43.ecce35ee.js"><link rel="prefetch" href="/javatech/assets/js/44.52f28acf.js"><link rel="prefetch" href="/javatech/assets/js/45.20f4f377.js"><link rel="prefetch" href="/javatech/assets/js/46.0a0260b9.js"><link rel="prefetch" href="/javatech/assets/js/47.eb304074.js"><link rel="prefetch" href="/javatech/assets/js/48.4b44c17f.js"><link rel="prefetch" href="/javatech/assets/js/49.7eb565e9.js"><link rel="prefetch" href="/javatech/assets/js/5.a5e63d96.js"><link rel="prefetch" href="/javatech/assets/js/50.8109a7ae.js"><link rel="prefetch" href="/javatech/assets/js/51.38b085ba.js"><link rel="prefetch" href="/javatech/assets/js/52.00ce2cbc.js"><link rel="prefetch" href="/javatech/assets/js/53.d6d7f478.js"><link rel="prefetch" href="/javatech/assets/js/54.dfdb8d1e.js"><link rel="prefetch" href="/javatech/assets/js/55.1826944b.js"><link rel="prefetch" href="/javatech/assets/js/56.66dbda5d.js"><link rel="prefetch" href="/javatech/assets/js/57.40473993.js"><link rel="prefetch" href="/javatech/assets/js/58.22b1ebc5.js"><link rel="prefetch" href="/javatech/assets/js/59.58783d5e.js"><link rel="prefetch" href="/javatech/assets/js/6.d667bc4d.js"><link rel="prefetch" href="/javatech/assets/js/61.b6341bd9.js"><link rel="prefetch" href="/javatech/assets/js/62.89e2b730.js"><link rel="prefetch" href="/javatech/assets/js/63.0e1450bd.js"><link rel="prefetch" href="/javatech/assets/js/64.c2b3eaf7.js"><link rel="prefetch" href="/javatech/assets/js/65.4faaada8.js"><link rel="prefetch" href="/javatech/assets/js/66.4c312605.js"><link rel="prefetch" href="/javatech/assets/js/67.bf8d7dc4.js"><link rel="prefetch" href="/javatech/assets/js/68.9e1d5c1a.js"><link rel="prefetch" href="/javatech/assets/js/69.717b63a7.js"><link rel="prefetch" href="/javatech/assets/js/7.49d24c76.js"><link rel="prefetch" href="/javatech/assets/js/8.319b7672.js"><link rel="prefetch" href="/javatech/assets/js/9.1c70efd1.js"><link rel="prefetch" href="/javatech/assets/js/vendors~flowchart.f5cdfab1.js"><link rel="prefetch" href="/javatech/assets/js/vendors~notification.7414fc30.js">
    <link rel="stylesheet" href="/javatech/assets/css/0.styles.0a04ceb6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javatech/" class="home-link router-link-active"><img src="images/dunwu-logo-100.png" alt="JAVATECH" class="logo"> <span class="site-name can-hide">JAVATECH</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/javatech/framework/" class="nav-link">
  框架
</a></div><div class="nav-item"><a href="/javatech/cache/" class="nav-link">
  缓存
</a></div><div class="nav-item"><a href="/javatech/mq/" class="nav-link">
  消息队列
</a></div><div class="nav-item"><a href="/javatech/search/" class="nav-link">
  搜索引擎
</a></div><div class="nav-item"><a href="/javatech/storage/" class="nav-link">
  存储
</a></div><div class="nav-item"><a href="/javatech/soa/" class="nav-link router-link-active">
  微服务
</a></div><div class="nav-item"><a href="/javatech/security/" class="nav-link">
  安全
</a></div><div class="nav-item"><a href="/javatech/test/" class="nav-link">
  测试
</a></div><div class="nav-item"><a href="/javatech/server/" class="nav-link">
  服务器
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/javatech" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/javatech/framework/" class="nav-link">
  框架
</a></div><div class="nav-item"><a href="/javatech/cache/" class="nav-link">
  缓存
</a></div><div class="nav-item"><a href="/javatech/mq/" class="nav-link">
  消息队列
</a></div><div class="nav-item"><a href="/javatech/search/" class="nav-link">
  搜索引擎
</a></div><div class="nav-item"><a href="/javatech/storage/" class="nav-link">
  存储
</a></div><div class="nav-item"><a href="/javatech/soa/" class="nav-link router-link-active">
  微服务
</a></div><div class="nav-item"><a href="/javatech/security/" class="nav-link">
  安全
</a></div><div class="nav-item"><a href="/javatech/test/" class="nav-link">
  测试
</a></div><div class="nav-item"><a href="/javatech/server/" class="nav-link">
  服务器
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javacore/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/javatech/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/javatech" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ZooKeeper 运维指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_1-单点服务部署" class="sidebar-link">1. 单点服务部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_1-1-下载解压" class="sidebar-link">1.1. 下载解压</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_1-2-环境变量" class="sidebar-link">1.2. 环境变量</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_1-3-修改配置" class="sidebar-link">1.3. 修改配置</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_1-4-启动服务" class="sidebar-link">1.4. 启动服务</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_1-5-停止服务" class="sidebar-link">1.5. 停止服务</a></li></ul></li><li><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_2-集群服务部署" class="sidebar-link">2. 集群服务部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_2-1-修改配置" class="sidebar-link">2.1. 修改配置</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_2-2-标识节点" class="sidebar-link">2.2. 标识节点</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_2-3-启动集群" class="sidebar-link">2.3. 启动集群</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_2-4-集群验证" class="sidebar-link">2.4. 集群验证</a></li></ul></li><li><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_3-命令" class="sidebar-link">3. 命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_3-1-进入命令行控制台" class="sidebar-link">3.1. 进入命令行控制台</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_3-2-节点增删改查" class="sidebar-link">3.2. 节点增删改查</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_3-3-监听器" class="sidebar-link">3.3. 监听器</a></li><li class="sidebar-sub-header"><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_3-4-zookeeper-四字命令" class="sidebar-link">3.4. zookeeper 四字命令</a></li></ul></li><li><a href="/javatech/soa/zookeeper/zookeeper-ops.html#_4-参考资料" class="sidebar-link">4. 参考资料</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="zookeeper-运维指南"><a href="#zookeeper-运维指南" class="header-anchor">#</a> ZooKeeper 运维指南</h1> <blockquote><p>环境要求：JDK6+</p></blockquote> <ul><li><a href="#1-%E5%8D%95%E7%82%B9%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2">1. 单点服务部署</a> <ul><li><a href="#11-%E4%B8%8B%E8%BD%BD%E8%A7%A3%E5%8E%8B">1.1. 下载解压</a></li> <li><a href="#12-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">1.2. 环境变量</a></li> <li><a href="#13-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE">1.3. 修改配置</a></li> <li><a href="#14-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1">1.4. 启动服务</a></li> <li><a href="#15-%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1">1.5. 停止服务</a></li></ul></li> <li><a href="#2-%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2">2. 集群服务部署</a> <ul><li><a href="#21-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE">2.1. 修改配置</a></li> <li><a href="#22-%E6%A0%87%E8%AF%86%E8%8A%82%E7%82%B9">2.2. 标识节点</a></li> <li><a href="#23-%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4">2.3. 启动集群</a></li> <li><a href="#24-%E9%9B%86%E7%BE%A4%E9%AA%8C%E8%AF%81">2.4. 集群验证</a></li></ul></li> <li><a href="#3-%E5%91%BD%E4%BB%A4">3. 命令</a> <ul><li><a href="#31-%E8%BF%9B%E5%85%A5%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8E%A7%E5%88%B6%E5%8F%B0">3.1. 进入命令行控制台</a></li> <li><a href="#32-%E8%8A%82%E7%82%B9%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5">3.2. 节点增删改查</a></li> <li><a href="#33-%E7%9B%91%E5%90%AC%E5%99%A8">3.3. 监听器</a></li> <li><a href="#34-zookeeper-%E5%9B%9B%E5%AD%97%E5%91%BD%E4%BB%A4">3.4. zookeeper 四字命令</a></li></ul></li> <li><a href="#4-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">4. 参考资料</a></li></ul> <h2 id="_1-单点服务部署"><a href="#_1-单点服务部署" class="header-anchor">#</a> 1. 单点服务部署</h2> <p>在安装 ZooKeeper 之前，请确保你的系统是在以下任一操作系统上运行：</p> <ul><li><strong>任意 Linux OS</strong> - 支持开发和部署。适合演示应用程序。</li> <li><strong>Windows OS</strong> - 仅支持开发。</li> <li><strong>Mac OS</strong> - 仅支持开发。</li></ul> <p>安装步骤如下：</p> <h3 id="_1-1-下载解压"><a href="#_1-1-下载解压" class="header-anchor">#</a> 1.1. 下载解压</h3> <p>进入官方下载地址：<a href="http://zookeeper.apache.org/releases.html#download" target="_blank" rel="noopener noreferrer">http://zookeeper.apache.org/releases.html#download<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，选择合适版本。</p> <p>解压到本地：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">tar</span> -zxf zookeeper-3.4.6.tar.gz
<span class="token builtin class-name">cd</span> zookeeper-3.4.6
</code></pre></div><h3 id="_1-2-环境变量"><a href="#_1-2-环境变量" class="header-anchor">#</a> 1.2. 环境变量</h3> <p>执行 <code>vim /etc/profile</code>，添加环境变量：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">ZOOKEEPER_HOME</span><span class="token operator">=</span>/usr/app/zookeeper-3.4.14
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$ZOOKEEPER_HOME</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre></div><p>再执行 <code>source /etc/profile</code> ， 使得配置的环境变量生效。</p> <h3 id="_1-3-修改配置"><a href="#_1-3-修改配置" class="header-anchor">#</a> 1.3. 修改配置</h3> <p>你必须创建 <code>conf/zoo.cfg</code> 文件，否则启动时会提示你没有此文件。</p> <p>初次尝试，不妨直接使用 Kafka 提供的模板配置文件 <code>conf/zoo_sample.cfg</code>：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cp</span> conf/zoo_sample.cfg conf/zoo.cfg
</code></pre></div><p>修改后完整配置如下：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># The number of milliseconds of each tick</span>
<span class="token attr-name">tickTime</span><span class="token punctuation">=</span><span class="token attr-value">2000</span>
<span class="token comment"># The number of ticks that the initial</span>
<span class="token comment"># synchronization phase can take</span>
<span class="token attr-name">initLimit</span><span class="token punctuation">=</span><span class="token attr-value">10</span>
<span class="token comment"># The number of ticks that can pass between</span>
<span class="token comment"># sending a request and getting an acknowledgement</span>
<span class="token attr-name">syncLimit</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
<span class="token comment"># the directory where the snapshot is stored.</span>
<span class="token comment"># do not use /tmp for storage, /tmp here is just</span>
<span class="token comment"># example sakes.</span>
<span class="token attr-name">dataDir</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/zookeeper/data</span>
<span class="token attr-name">dataLogDir</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/zookeeper/log</span>
<span class="token comment"># the port at which the clients will connect</span>
<span class="token attr-name">clientPort</span><span class="token punctuation">=</span><span class="token attr-value">2181</span>
<span class="token comment"># the maximum number of client connections.</span>
<span class="token comment"># increase this if you need to handle more clients</span>
<span class="token comment">#maxClientCnxns=60</span>
<span class="token comment">#</span>
<span class="token comment"># Be sure to read the maintenance section of the</span>
<span class="token comment"># administrator guide before turning on autopurge.</span>
<span class="token comment">#</span>
<span class="token comment"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span>
<span class="token comment">#</span>
<span class="token comment"># The number of snapshots to retain in dataDir</span>
<span class="token comment">#autopurge.snapRetainCount=3</span>
<span class="token comment"># Purge task interval in hours</span>
<span class="token comment"># Set to &quot;0&quot; to disable auto purge feature</span>
<span class="token comment">#autopurge.purgeInterval=1</span>
</code></pre></div><p>配置参数说明：</p> <ul><li><strong>tickTime</strong>：用于计算的基础时间单元。比如 session 超时：N*tickTime；</li> <li><strong>initLimit</strong>：用于集群，允许从节点连接并同步到 master 节点的初始化连接时间，以 tickTime 的倍数来表示；</li> <li><strong>syncLimit</strong>：用于集群， master 主节点与从节点之间发送消息，请求和应答时间长度（心跳机制）；</li> <li><strong>dataDir</strong>：数据存储位置；</li> <li><strong>dataLogDir</strong>：日志目录；</li> <li><strong>clientPort</strong>：用于客户端连接的端口，默认 2181</li></ul> <h3 id="_1-4-启动服务"><a href="#_1-4-启动服务" class="header-anchor">#</a> 1.4. 启动服务</h3> <p>执行以下命令</p> <div class="language-bash extra-class"><pre class="language-bash"><code>bin/zkServer.sh start
</code></pre></div><p>执行此命令后，你将收到以下响应</p> <div class="language-bash extra-class"><pre class="language-bash"><code>JMX enabled by default
Using config: /Users/<span class="token punctuation">..</span>/zookeeper-3.4.6/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Starting zookeeper <span class="token punctuation">..</span>. STARTED
</code></pre></div><h3 id="_1-5-停止服务"><a href="#_1-5-停止服务" class="header-anchor">#</a> 1.5. 停止服务</h3> <p>可以使用以下命令停止 zookeeper 服务器。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>bin/zkServer.sh stop
</code></pre></div><h2 id="_2-集群服务部署"><a href="#_2-集群服务部署" class="header-anchor">#</a> 2. 集群服务部署</h2> <p>分布式系统节点数一般都要求是奇数，且最少为 3 个节点，Zookeeper 也不例外。</p> <p>这里，规划一个含 3 个节点的最小 ZooKeeper 集群，主机名分别为 hadoop001，hadoop002，hadoop003 。</p> <h3 id="_2-1-修改配置"><a href="#_2-1-修改配置" class="header-anchor">#</a> 2.1. 修改配置</h3> <p>修改配置文件 <code>zoo.cfg</code>，内容如下：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">tickTime</span><span class="token punctuation">=</span><span class="token attr-value">2000</span>
<span class="token attr-name">initLimit</span><span class="token punctuation">=</span><span class="token attr-value">10</span>
<span class="token attr-name">syncLimit</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
<span class="token attr-name">dataDir</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/zookeeper-cluster/data/</span>
<span class="token attr-name">dataLogDir</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/zookeeper-cluster/log/</span>
<span class="token attr-name">clientPort</span><span class="token punctuation">=</span><span class="token attr-value">2181</span>

<span class="token comment"># server.1 这个1是服务器的标识，可以是任意有效数字，标识这是第几个服务器节点，这个标识要写到dataDir目录下面myid文件里</span>
<span class="token comment"># 指名集群间通讯端口和选举端口</span>
<span class="token attr-name">server.1</span><span class="token punctuation">=</span><span class="token attr-value">hadoop001:2287:3387</span>
<span class="token attr-name">server.2</span><span class="token punctuation">=</span><span class="token attr-value">hadoop002:2287:3387</span>
<span class="token attr-name">server.3</span><span class="token punctuation">=</span><span class="token attr-value">hadoop003:2287:3387</span>
</code></pre></div><h3 id="_2-2-标识节点"><a href="#_2-2-标识节点" class="header-anchor">#</a> 2.2. 标识节点</h3> <p>分别在三台主机的 <code>dataDir</code> 目录下新建 <code>myid</code> 文件,并写入对应的节点标识。Zookeeper 集群通过 <code>myid</code> 文件识别集群节点，并通过上文配置的节点通信端口和选举端口来进行节点通信，选举出 Leader 节点。</p> <p>创建存储目录：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 三台主机均执行该命令</span>
<span class="token function">mkdir</span> -vp  /usr/local/zookeeper-cluster/data/
</code></pre></div><p>创建并写入节点标识到 <code>myid</code> 文件：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># hadoop001主机</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;1&quot;</span> <span class="token operator">&gt;</span> /usr/local/zookeeper-cluster/data/myid
<span class="token comment"># hadoop002主机</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;2&quot;</span> <span class="token operator">&gt;</span> /usr/local/zookeeper-cluster/data/myid
<span class="token comment"># hadoop003主机</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;3&quot;</span> <span class="token operator">&gt;</span> /usr/local/zookeeper-cluster/data/myid
</code></pre></div><h3 id="_2-3-启动集群"><a href="#_2-3-启动集群" class="header-anchor">#</a> 2.3. 启动集群</h3> <p>分别在三台主机上，执行如下命令启动服务：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/app/zookeeper-cluster/zookeeper/bin/zkServer.sh start
</code></pre></div><h3 id="_2-4-集群验证"><a href="#_2-4-集群验证" class="header-anchor">#</a> 2.4. 集群验证</h3> <p>启动后使用 <code>zkServer.sh status</code> 查看集群各个节点状态。</p> <h2 id="_3-命令"><a href="#_3-命令" class="header-anchor">#</a> 3. 命令</h2> <h3 id="_3-1-进入命令行控制台"><a href="#_3-1-进入命令行控制台" class="header-anchor">#</a> 3.1. 进入命令行控制台</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>bin/zkCli.sh
</code></pre></div><p>键入上述命令后，将连接到 ZooKeeper 服务器，你应该得到以下响应。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Connecting to localhost:2181
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Welcome to ZooKeeper<span class="token operator">!</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
WATCHER::
WatchedEvent state:SyncConnected type: None path:null
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="_3-2-节点增删改查"><a href="#_3-2-节点增删改查" class="header-anchor">#</a> 3.2. 节点增删改查</h3> <h4 id="_3-2-1-启动服务和连接服务"><a href="#_3-2-1-启动服务和连接服务" class="header-anchor">#</a> 3.2.1. 启动服务和连接服务</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 启动服务</span>
bin/zkServer.sh start

<span class="token comment">#连接服务 不指定服务地址则默认连接到localhost:2181</span>
zkCli.sh -server hadoop001:2181
</code></pre></div><h4 id="_3-2-2-help-命令"><a href="#_3-2-2-help-命令" class="header-anchor">#</a> 3.2.2. help 命令</h4> <p>使用 <code>help</code> 可以查看所有命令及格式。</p> <h4 id="_3-2-3-查看节点列表"><a href="#_3-2-3-查看节点列表" class="header-anchor">#</a> 3.2.3. 查看节点列表</h4> <p>查看节点列表有 <code>ls path</code> 和 <code>ls2 path</code> 两个命令，后者是前者的增强，不仅可以查看指定路径下的所有节点，还可以查看当前节点的信息。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>cluster, controller_epoch, brokers, storm, zookeeper, admin,  <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">]</span> ls2 /
<span class="token punctuation">[</span>cluster, controller_epoch, brokers, storm, zookeeper, admin, <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">]</span>
cZxid <span class="token operator">=</span> 0x0
ctime <span class="token operator">=</span> Thu Jan 01 08:00:00 CST <span class="token number">1970</span>
mZxid <span class="token operator">=</span> 0x0
mtime <span class="token operator">=</span> Thu Jan 01 08:00:00 CST <span class="token number">1970</span>
pZxid <span class="token operator">=</span> 0x130
cversion <span class="token operator">=</span> <span class="token number">19</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
dataLength <span class="token operator">=</span> <span class="token number">0</span>
numChildren <span class="token operator">=</span> <span class="token number">11</span>
</code></pre></div><h4 id="_3-2-4-新增节点"><a href="#_3-2-4-新增节点" class="header-anchor">#</a> 3.2.4. 新增节点</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>create <span class="token punctuation">[</span>-s<span class="token punctuation">]</span> <span class="token punctuation">[</span>-e<span class="token punctuation">]</span> path data acl   <span class="token comment"># 其中 -s 为有序节点，-e 临时节点</span>
</code></pre></div><p>flag 参数指定创建的 znode 是持久的、临时的（-e），还是顺序的（-s）。</p> <ul><li>默认情况下，所有 znode 都是持久的。</li> <li>顺序节点保证 znode 路径将是唯一的。</li> <li>临时节点会在会话过期或客户端断开连接时被自动删除。</li></ul> <p>例：创建持久节点</p> <div class="language-bash extra-class"><pre class="language-bash"><code>create /hadoop <span class="token number">123456</span>
</code></pre></div><p>例：创建有序节点，此时创建的节点名为指定节点名 + 自增序号：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">23</span><span class="token punctuation">]</span> create -s /a  <span class="token string">&quot;aaa&quot;</span>
Created /a0000000022
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">24</span><span class="token punctuation">]</span> create -s /b  <span class="token string">&quot;bbb&quot;</span>
Created /b0000000023
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">25</span><span class="token punctuation">]</span> create -s /c  <span class="token string">&quot;ccc&quot;</span>
Created /c0000000024
</code></pre></div><p>例：创建临时节点：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">26</span><span class="token punctuation">]</span> create -e /tmp  <span class="token string">&quot;tmp&quot;</span>
Created /tmp
</code></pre></div><h4 id="_3-2-5-查看节点"><a href="#_3-2-5-查看节点" class="header-anchor">#</a> 3.2.5. 查看节点</h4> <h5 id="获取节点数据"><a href="#获取节点数据" class="header-anchor">#</a> 获取节点数据</h5> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 格式</span>
get path <span class="token punctuation">[</span>watch<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">31</span><span class="token punctuation">]</span> get /hadoop
<span class="token number">123456</span>   <span class="token comment">#节点数据</span>
cZxid <span class="token operator">=</span> 0x14b
ctime <span class="token operator">=</span> Fri May <span class="token number">24</span> <span class="token number">17</span>:03:06 CST <span class="token number">2019</span>
mZxid <span class="token operator">=</span> 0x14b
mtime <span class="token operator">=</span> Fri May <span class="token number">24</span> <span class="token number">17</span>:03:06 CST <span class="token number">2019</span>
pZxid <span class="token operator">=</span> 0x14b
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
dataLength <span class="token operator">=</span> <span class="token number">6</span>
numChildren <span class="token operator">=</span> <span class="token number">0</span>
</code></pre></div><p>节点各个属性如下表。其中一个重要的概念是 Zxid(ZooKeeper Transaction Id)，ZooKeeper 节点的每一次更改都具有唯一的 Zxid，如果 Zxid1 小于 Zxid2，则 Zxid1 的更改发生在 Zxid2 更改之前。</p> <table><thead><tr><th><strong>状态属性</strong></th> <th><strong>说明</strong></th></tr></thead> <tbody><tr><td>cZxid</td> <td>数据节点创建时的事务 ID</td></tr> <tr><td>ctime</td> <td>数据节点创建时的时间</td></tr> <tr><td>mZxid</td> <td>数据节点最后一次更新时的事务 ID</td></tr> <tr><td>mtime</td> <td>数据节点最后一次更新时的时间</td></tr> <tr><td>pZxid</td> <td>数据节点的子节点最后一次被修改时的事务 ID</td></tr> <tr><td>cversion</td> <td>子节点的更改次数</td></tr> <tr><td>dataVersion</td> <td>节点数据的更改次数</td></tr> <tr><td>aclVersion</td> <td>节点的 ACL 的更改次数</td></tr> <tr><td>ephemeralOwner</td> <td>如果节点是临时节点，则表示创建该节点的会话的 SessionID；如果节点是持久节点，则该属性值为 0</td></tr> <tr><td>dataLength</td> <td>数据内容的长度</td></tr> <tr><td>numChildren</td> <td>数据节点当前的子节点个数</td></tr></tbody></table> <h5 id="查看节点状态"><a href="#查看节点状态" class="header-anchor">#</a> 查看节点状态</h5> <p>可以使用 <code>stat</code> 命令查看节点状态，它的返回值和 <code>get</code> 命令类似，但不会返回节点数据。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">32</span><span class="token punctuation">]</span> <span class="token function">stat</span> /hadoop
cZxid <span class="token operator">=</span> 0x14b
ctime <span class="token operator">=</span> Fri May <span class="token number">24</span> <span class="token number">17</span>:03:06 CST <span class="token number">2019</span>
mZxid <span class="token operator">=</span> 0x14b
mtime <span class="token operator">=</span> Fri May <span class="token number">24</span> <span class="token number">17</span>:03:06 CST <span class="token number">2019</span>
pZxid <span class="token operator">=</span> 0x14b
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
dataLength <span class="token operator">=</span> <span class="token number">6</span>
numChildren <span class="token operator">=</span> <span class="token number">0</span>
</code></pre></div><h4 id="_3-2-6-更新节点"><a href="#_3-2-6-更新节点" class="header-anchor">#</a> 3.2.6. 更新节点</h4> <p>更新节点的命令是 <code>set</code>，可以直接进行修改，如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">33</span><span class="token punctuation">]</span> <span class="token builtin class-name">set</span> /hadoop <span class="token number">345</span>
cZxid <span class="token operator">=</span> 0x14b
ctime <span class="token operator">=</span> Fri May <span class="token number">24</span> <span class="token number">17</span>:03:06 CST <span class="token number">2019</span>
mZxid <span class="token operator">=</span> 0x14c
mtime <span class="token operator">=</span> Fri May <span class="token number">24</span> <span class="token number">17</span>:13:05 CST <span class="token number">2019</span>
pZxid <span class="token operator">=</span> 0x14b
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 注意更改后此时版本号为 1，默认创建时为 0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
dataLength <span class="token operator">=</span> <span class="token number">3</span>
numChildren <span class="token operator">=</span> <span class="token number">0</span>
</code></pre></div><p>也可以基于版本号进行更改，此时类似于乐观锁机制，当你传入的数据版本号 (dataVersion) 和当前节点的数据版本号不符合时，zookeeper 会拒绝本次修改：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">34</span><span class="token punctuation">]</span> <span class="token builtin class-name">set</span> /hadoop <span class="token number">678</span> <span class="token number">0</span>
version No is not valid <span class="token builtin class-name">:</span> /hadoop    <span class="token comment">#无效的版本号</span>
</code></pre></div><h4 id="_3-2-7-删除节点"><a href="#_3-2-7-删除节点" class="header-anchor">#</a> 3.2.7. 删除节点</h4> <p>删除节点的语法如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>delete path <span class="token punctuation">[</span>version<span class="token punctuation">]</span>
</code></pre></div><p>和更新节点数据一样，也可以传入版本号，当你传入的数据版本号 (dataVersion) 和当前节点的数据版本号不符合时，zookeeper 不会执行删除操作。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">36</span><span class="token punctuation">]</span> delete /hadoop <span class="token number">0</span>
version No is not valid <span class="token builtin class-name">:</span> /hadoop   <span class="token comment">#无效的版本号</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">37</span><span class="token punctuation">]</span> delete /hadoop <span class="token number">1</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">38</span><span class="token punctuation">]</span>
</code></pre></div><p>要想删除某个节点及其所有后代节点，可以使用递归删除，命令为 <code>rmr path</code>。</p> <h3 id="_3-3-监听器"><a href="#_3-3-监听器" class="header-anchor">#</a> 3.3. 监听器</h3> <h4 id="_3-3-1-get-path"><a href="#_3-3-1-get-path" class="header-anchor">#</a> 3.3.1. get path</h4> <p>使用 <code>get path [watch]</code> 注册的监听器能够在节点内容发生改变的时候，向客户端发出通知。需要注意的是 zookeeper 的触发器是一次性的 (One-time trigger)，即触发一次后就会立即失效。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">]</span> get /hadoop  <span class="token function">watch</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token builtin class-name">set</span> /hadoop <span class="token number">45678</span>
WATCHER::
WatchedEvent state:SyncConnected type:NodeDataChanged path:/hadoop  <span class="token comment">#节点值改变</span>
</code></pre></div><h4 id="_3-3-2-stat-path"><a href="#_3-3-2-stat-path" class="header-anchor">#</a> 3.3.2. stat path</h4> <p>使用 <code>stat path [watch]</code> 注册的监听器能够在节点状态发生改变的时候，向客户端发出通知。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token function">stat</span> /hadoop <span class="token function">watch</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token builtin class-name">set</span> /hadoop <span class="token number">112233</span>
WATCHER::
WatchedEvent state:SyncConnected type:NodeDataChanged path:/hadoop  <span class="token comment">#节点值改变</span>
</code></pre></div><h4 id="_3-3-3-ls-ls2-path"><a href="#_3-3-3-ls-ls2-path" class="header-anchor">#</a> 3.3.3. ls\ls2 path</h4> <p>使用 <code>ls path [watch]</code> 或 <code>ls2 path [watch]</code> 注册的监听器能够监听该节点下所有<strong>子节点</strong>的增加和删除操作。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">9</span><span class="token punctuation">]</span> <span class="token function">ls</span> /hadoop <span class="token function">watch</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">10</span><span class="token punctuation">]</span> create  /hadoop/yarn <span class="token string">&quot;aaa&quot;</span>
WATCHER::
WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/hadoop
</code></pre></div><h3 id="_3-4-zookeeper-四字命令"><a href="#_3-4-zookeeper-四字命令" class="header-anchor">#</a> 3.4. zookeeper 四字命令</h3> <table><thead><tr><th>命令</th> <th>功能描述</th></tr></thead> <tbody><tr><td>conf</td> <td>打印服务配置的详细信息。</td></tr> <tr><td>cons</td> <td>列出连接到此服务器的所有客户端的完整连接/会话详细信息。包括接收/发送的数据包数量，会话 ID，操作延迟，上次执行的操作等信息。</td></tr> <tr><td>dump</td> <td>列出未完成的会话和临时节点。这只适用于 Leader 节点。</td></tr> <tr><td>envi</td> <td>打印服务环境的详细信息。</td></tr> <tr><td>ruok</td> <td>测试服务是否处于正确状态。如果正确则返回“imok”，否则不做任何相应。</td></tr> <tr><td>stat</td> <td>列出服务器和连接客户端的简要详细信息。</td></tr> <tr><td>wchs</td> <td>列出所有 watch 的简单信息。</td></tr> <tr><td>wchc</td> <td>按会话列出服务器 watch 的详细信息。</td></tr> <tr><td>wchp</td> <td>按路径列出服务器 watch 的详细信息。</td></tr></tbody></table> <blockquote><p>更多四字命令可以参阅官方文档：<a href="https://zookeeper.apache.org/doc/current/zookeeperAdmin.html" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/current/zookeeperAdmin.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>使用前需要使用 <code>yum install nc</code> 安装 nc 命令，使用示例如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@hadoop001 bin<span class="token punctuation">]</span><span class="token comment"># echo stat | nc localhost 2181</span>
Zookeeper version: <span class="token number">3.4</span>.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03,
built on 06/29/2018 04:05 GMT
Clients:
 /0:0:0:0:0:0:0:1:50584<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span>queued<span class="token operator">=</span><span class="token number">0</span>,recved<span class="token operator">=</span><span class="token number">371</span>,sent<span class="token operator">=</span><span class="token number">371</span><span class="token punctuation">)</span>
 /0:0:0:0:0:0:0:1:50656<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span>queued<span class="token operator">=</span><span class="token number">0</span>,recved<span class="token operator">=</span><span class="token number">1</span>,sent<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
Latency min/avg/max: <span class="token number">0</span>/0/19
Received: <span class="token number">372</span>
Sent: <span class="token number">371</span>
Connections: <span class="token number">2</span>
Outstanding: <span class="token number">0</span>
Zxid: 0x150
Mode: standalone
Node count: <span class="token number">167</span>
</code></pre></div><h2 id="_4-参考资料"><a href="#_4-参考资料" class="header-anchor">#</a> 4. 参考资料</h2> <ul><li><a href="https://www.w3cschool.cn/zookeeper/zookeeper_installation.html" target="_blank" rel="noopener noreferrer">Zookeeper 安装<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/heibaiying/BigData-Notes/blob/master/notes/installation/Zookeeper%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E5%92%8C%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.md" target="_blank" rel="noopener noreferrer">Zookeeper 单机环境和集群环境搭建<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/javatech/edit/master/docs/soa/zookeeper/zookeeper-ops.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/javatech/assets/js/app.fda27f19.js" defer></script><script src="/javatech/assets/js/4.712970d0.js" defer></script><script src="/javatech/assets/js/60.c674f4b5.js" defer></script>
  </body>
</html>
